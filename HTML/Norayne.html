
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Norayne.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        /* === Description typography controls ===
           Tweak these two variables to change description sizes globally */
        :root {
            --desc-font-size: 130%;
            --hull-desc-font-size: 130%;
        }
        .desc-text { font-size: var(--desc-font-size); margin-top: 8px; }
        .hull-desc { font-size: var(--hull-desc-font-size); margin-top: 5px; color: #ccc; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Norayne</h2>
        <h3 class="subheader">Alignment: Torgoth</h3>
        <img src="Images/Factions/Torgoth.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Nakkuti": {"type": "blackhole", "x": -576.3463076227708, "y": 1264.726224215001, "grid": "M11"}, "Charon Gate": {"type": "jumpnode", "x": -81960.40455442769, "y": -142366.49010801828, "grid": "E07", "hidden": false, "label": "Charon Gate", "destinations": {"Norayne Gate": "Charon"}}, "Holtair Gate": {"type": "jumpnode", "x": 156687.20835233195, "y": 160766.06816720657, "grid": "U19", "hidden": false, "label": "Holtair Gate", "destinations": {"Norayne Gate": "Holtair"}}, "Jotar Gate": {"type": "jumpnode", "x": -187377.60646248283, "y": 116145.6977968362, "grid": "R02", "hidden": false, "label": "Jotar Gate", "destinations": {"Jotar Gate": "Jotar"}}, "WP 97": {"type": "platform", "x": -61562.2358892994, "y": -114918.68792914202, "grid": "G08", "hidden": false, "label": "WP 97"}, "WP 80": {"type": "platform", "x": -51243.82364911481, "y": -124452.0035858343, "grid": "F09", "hidden": false, "label": "WP 80"}, "WP 57": {"type": "platform", "x": -45523.834255099435, "y": -137125.70557649582, "grid": "F09", "hidden": false, "label": "WP 57"}, "WP 23": {"type": "platform", "x": -44963.05098117636, "y": -152266.85397241884, "grid": "E09", "hidden": false, "label": "WP 23"}, "WP 55": {"type": "platform", "x": -51580.29361346865, "y": -165725.65254657267, "grid": "D09", "hidden": false, "label": "WP 55"}, "WP 69": {"type": "platform", "x": -61450.079234514786, "y": -174586.02827455726, "grid": "D08", "hidden": false, "label": "WP 69"}, "WP 14": {"type": "platform", "x": -75693.9743921609, "y": -178735.82450158804, "grid": "D08", "hidden": false, "label": "WP 14"}, "WP 39": {"type": "platform", "x": -89937.86954980703, "y": -178623.6678468034, "grid": "D07", "hidden": false, "label": "WP 39"}, "WP 54": {"type": "platform", "x": -103396.66812396084, "y": -171109.1719762342, "grid": "D06", "hidden": false, "label": "WP 54"}, "WP 68": {"type": "platform", "x": -111359.79061366852, "y": -159332.7232238496, "grid": "E06", "hidden": false, "label": "WP 68"}, "WP 71": {"type": "platform", "x": -113715.08036414544, "y": -144303.73148271118, "grid": "E06", "hidden": false, "label": "WP 71"}, "WP 27": {"type": "platform", "x": -111359.7906136685, "y": -129723.36636071121, "grid": "F06", "hidden": false, "label": "WP 27"}, "WP 22": {"type": "platform", "x": -101826.47495697624, "y": -118732.01419181893, "grid": "G06", "hidden": false, "label": "WP 22"}, "WP 48": {"type": "platform", "x": -89377.08627588395, "y": -111666.14494038819, "grid": "G07", "hidden": false, "label": "WP 48"}, "WP 34": {"type": "platform", "x": -75357.50442780706, "y": -110432.42173775741, "grid": "G08", "hidden": false, "label": "WP 34"}, "Brekka": {"type": "station", "x": -7321.497485034783, "y": -187182.3123846099, "grid": "C11", "hidden": false, "label": "Brekka", "hull": "starbase_command", "facilities": [], "sides": ["Torgoth"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Isa Aka": {"type": "station", "x": -232309.5304640014, "y": -165890.39208854217, "grid": "D00", "hidden": true, "label": "**Isa Aka**", "hull": "starbase_science", "facilities": [], "sides": ["Torgoth"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "Ri Ishi": {"type": "station", "x": -108681.22385106137, "y": -5480.544980631801, "grid": "L06", "hidden": false, "label": "Ri Ishi", "hull": "starbase_command", "facilities": [], "sides": ["Torgoth"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Throsc": {"type": "station", "x": -113528.28289114355, "y": -11081.362204462856, "grid": "L06", "hidden": false, "label": "Throsc", "hull": "starbase_command", "facilities": [], "sides": ["Torgoth"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Vraknor": {"type": "station", "x": -194204.52203350308, "y": 158555.69901799646, "grid": "T02", "hidden": false, "label": "Vraknor", "hull": "starbase_civil", "facilities": [], "sides": ["Torgoth"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Ruktarn": {"type": "station", "x": -176496.18870016976, "y": 146865.88420318163, "grid": "T03", "hidden": false, "label": "Ruktarn", "hull": "starbase_command", "facilities": [], "sides": ["Torgoth"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Krashnekk": {"type": "station", "x": 139670.7397070715, "y": 140298.8534138862, "grid": "T18", "hidden": false, "label": "Krashnekk", "hull": "starbase_command", "facilities": [], "sides": ["Torgoth"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Mardruk": {"type": "station", "x": 144586.76921184055, "y": 128954.36142939611, "grid": "S19", "hidden": false, "label": "Mardruk", "hull": "starbase_civil", "facilities": [], "sides": ["Torgoth"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "WP 4": {"type": "platform", "x": -120308.77417947145, "y": -6832.148113961602, "grid": "L05", "hidden": false, "label": "WP 4"}, "WP 95": {"type": "platform", "x": -110101.28450532122, "y": -14856.077189774474, "grid": "L06", "hidden": false, "label": "WP 95"}, "WP 21": {"type": "platform", "x": -103573.67730537482, "y": -2692.769395806452, "grid": "L06", "hidden": false, "label": "WP 21"}, "WP 58": {"type": "platform", "x": -10338.215592030529, "y": -178055.49624092004, "grid": "D11", "hidden": false, "label": "WP 58"}, "WP 93": {"type": "platform", "x": 141418.0311276798, "y": 129829.5773675911, "grid": "S19", "hidden": false, "label": "WP 93"}, "WP 12": {"type": "platform", "x": 140949.0877823587, "y": 138220.16344531055, "grid": "S19", "hidden": false, "label": "WP 12"}, "Drengol": {"type": "station", "x": 258844.46223565275, "y": -170936.74819176283, "grid": "D24", "hidden": true, "label": "**Drengol**", "hull": "starbase_science", "facilities": [], "sides": ["Torgoth"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "WP 75": {"type": "platform", "x": 258097.59778576953, "y": -173623.41650318867, "grid": "D24", "hidden": true, "label": "**WP 75**"}, "WP 78": {"type": "platform", "x": 259880.4549449176, "y": -169240.20077681032, "grid": "D24", "hidden": true, "label": "**WP 78**"}, "SR 56": {"type": "sensor_relay", "x": -168731.75135258527, "y": 104961.82387034365, "grid": "R03", "hidden": false, "label": "SR 56"}, "SR 81": {"type": "sensor_relay", "x": -178230.9833198921, "y": -183068.78312554111, "grid": "C03", "hidden": false, "label": "SR 81"}, "SR 35": {"type": "sensor_relay", "x": -25137.615550116152, "y": -182115.72242595264, "grid": "C10", "hidden": false, "label": "SR 35"}, "SR 38": {"type": "sensor_relay", "x": -99187.36371014534, "y": -3467.4183063072737, "grid": "L07", "hidden": false, "label": "SR 38"}, "SR 71": {"type": "sensor_relay", "x": 125535.98124819963, "y": 135071.4923088438, "grid": "S18", "hidden": false, "label": "SR 71"}, "SR 41": {"type": "sensor_relay", "x": 195652.3649930556, "y": 169679.902802671, "grid": "U21", "hidden": false, "label": "SR 41"}, "SR 75": {"type": "sensor_relay", "x": -211774.33253780863, "y": 133615.08798785618, "grid": "S01", "hidden": false, "label": "SR 75"}, "SR 73": {"type": "sensor_relay", "x": 195403.9572630876, "y": -138014.62027681078, "grid": "F21", "hidden": false, "label": "SR 73"}, "SR 83": {"type": "sensor_relay", "x": -237695.43908703048, "y": -78003.75036170315, "grid": "I00", "hidden": false, "label": "SR 83"}, "SR 88": {"type": "sensor_relay", "x": -254962.10575369713, "y": 34496.249638296875, "grid": "N99", "hidden": false, "label": "SR 88"}, "SR 17": {"type": "sensor_relay", "x": -124728.77242036379, "y": 215096.2496382969, "grid": "W05", "hidden": false, "label": "SR 17"}, "SR 21": {"type": "sensor_relay", "x": -10028.772420363748, "y": 238429.5829716302, "grid": "X11", "hidden": false, "label": "SR 21"}, "SR 84": {"type": "sensor_relay", "x": 101604.56091296951, "y": 226529.5829716302, "grid": "X17", "hidden": false, "label": "SR 84"}, "SR 60": {"type": "sensor_relay", "x": 240871.22757963624, "y": 98662.91630496354, "grid": "Q24", "hidden": false, "label": "SR 60"}, "SR 12": {"type": "sensor_relay", "x": 257537.89424630292, "y": 20329.582971630203, "grid": "N24", "hidden": false, "label": "SR 12"}, "SR 23": {"type": "sensor_relay", "x": 240871.22757963624, "y": -60503.75036170314, "grid": "I24", "hidden": false, "label": "SR 23"}, "SR 10": {"type": "sensor_relay", "x": 151364.1116674278, "y": -204952.80300230673, "grid": "B19", "hidden": false, "label": "SR 10"}, "SR 25": {"type": "sensor_relay", "x": 79364.11166742777, "y": -244952.80300230673, "grid": "Z15", "hidden": false, "label": "SR 25"}, "SR 43": {"type": "sensor_relay", "x": -635.8883325722218, "y": -261952.80300230673, "grid": "Y11", "hidden": false, "label": "SR 43"}, "SR 65": {"type": "sensor_relay", "x": -103635.88833257221, "y": -237952.80300230673, "grid": "A06", "hidden": false, "label": "SR 65"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p class="hull-desc">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else if (obj.type === 'planet') {
            if (obj['class']) {
                infoHtml += '<b>Class:</b> ' + obj['class'] + '<br>';
            }
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p class="desc-text">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [16514.743506568288, 16112.865934551824, 22112.032774789426, 22513.91034680589, 16514.743506568288], "y": [26253.33377485993, 2140.6794538722766, 2040.6933398683161, 26153.347660855972, 26253.33377485993], "fill": "toself", "fillcolor": "rgba(128,0,128,0.777492022494793)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.777492022494793)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [765.2340036558942, -19328.644597167153, -23240.880210135434, -3147.0016093123904, 765.2340036558942], "y": [23347.147231138377, 40627.882827846195, 36078.77164997609, 18798.036053268275, 23347.147231138377], "fill": "toself", "fillcolor": "rgba(128,0,128,0.7074777703823577)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.7074777703823577)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-18047.01542306515, -40744.5824713276, -38378.76984813775, -15681.202799875293, -18047.01542306515], "y": [21418.26883881283, 11679.547749858402, 6165.662492441856, 15904.383581396285, 21418.26883881283], "fill": "toself", "fillcolor": "rgba(128,0,128,0.759151471732111)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.759151471732111)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-16066.264280232219, -15664.386708215763, -21663.698121537647, -22065.575693554103, -16066.264280232219], "y": [-26488.070545187235, 35.849207899186275, 126.74786567679027, -26397.171887409633, -26488.070545187235], "fill": "toself", "fillcolor": "rgba(128,0,128,0.706827962878651)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.706827962878651)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [17536.499960473484, 287.70370783795533, -3804.448825550294, 13444.347427085237, 17536.499960473484], "y": [-31922.397539853773, -15836.441484025136, -20224.412272839043, -36310.36832866768, -31922.397539853773], "fill": "toself", "fillcolor": "rgba(128,0,128,0.7949777198480311)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.7949777198480311)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [37031.01440349667, 13386.597068423245, 16139.567621820519, 39783.984956893946, 37031.01440349667], "y": [-1906.7587188513612, -14116.580785323702, -19447.730110950168, -7237.9080444778265, -1906.7587188513612], "fill": "toself", "fillcolor": "rgba(128,0,128,0.704599373564177)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.704599373564177)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-50577.436760117336, -13754.1638612325, -18661.130256833178, -55484.40315571802, -50577.436760117336], "y": [12567.545594125635, 33304.86243718183, 42018.16725179985, 21280.85040874366, 12567.545594125635], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [22689.838170652216, -13358.207930361361, -19832.31298557558, 16215.733115437997, 22689.838170652216], "y": [26161.492992450687, 56782.951508365455, 49161.536696530995, 18540.078180616227, 26161.492992450687], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-30007.168152698203, -30394.781551633834, -40394.23906105921, -40006.62566212358, -30007.168152698203], "y": [-24885.96857575179, 12324.917722068678, 12220.756706345497, -24990.129591474975, -24885.96857575179], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [10412.854455043642, -15277.208614266296, -22177.059689962574, 3513.003379347362, 10412.854455043642], "y": [-42319.47378341915, -17830.41067481443, -25068.646311571003, -49557.70942017573, -42319.47378341915], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [11959.043414723512, 54533.53993985525, 51130.73872670493, 8556.242201573195, 11959.043414723512], "y": [-36298.51641029631, -20891.855420191667, -11488.614281957325, -26895.275272061965, -36298.51641029631], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [38171.21061809627, 39572.71193016875, 29579.728283104807, 28178.22697103233, 38171.21061809627], "y": [-7666.702283666416, 29726.629816580862, 30101.166636550064, -7292.165463697214, -7666.702283666416], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-149822.56609266836, -217322.56609266836, -245949.63883300105, -178449.63883300105, -149822.56609266836], "y": [-206616.4474191901, -137449.78075252348, -165387.04451116137, -234553.711177828, -206616.4474191901], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [252762.61460755754, 310262.61460755754, 276465.1804667731, 218965.1804667731, 252762.61460755754], "y": [-223782.432306372, -132949.0989730387, -111554.39295731278, -202387.7262906461, -223782.432306372], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [66546.44473616206, 190782.75714052012, 152611.7046004772, 28375.392196119145, 66546.44473616206], "y": [-165240.034786336, -18399.274785286878, 13895.782854935458, -132944.9771461137, -165240.034786336], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-155753.18417688506, -34086.517510218386, -59185.68741545097, -180852.35408211767, -155753.18417688506], "y": [34531.933841631544, 220365.2671749649, 236797.90756135038, 50964.57422801701, 34531.933841631544], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-161640.48914945257, -158307.1558161192, -178298.38244288354, -181631.7157762169, -161640.48914945257], "y": [-61714.57895223889, 50785.42104776111, 51377.75368855413, -61122.24631144587, -61714.57895223889], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [132085.91906479956, 67782.92293311219, 53944.87214121845, 118247.86827290582, 132085.91906479956], "y": [120844.94096469512, 182468.1631457648, 168028.34492388373, 106405.12274281404, 120844.94096469512], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-228425.50001226706, -171758.83334560043, -186104.420962785, -242771.08762945162, -228425.50001226706], "y": [161899.22435268565, 220232.55768601902, 234168.271371284, 175834.93803795063, 161899.22435268565], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-137049.15871475724, -62882.49204809057, -88450.38728087074, -162617.05394753738, -137049.15871475724], "y": [40778.33297197035, 161611.6663053037, 177305.0640688722, 56471.73073553886, 40778.33297197035], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [266031.3147122679, 276031.3147122679, 256105.4309793468, 246105.4309793468, 266031.3147122679], "y": [-226993.02889387275, -111159.69556053939, -109439.47538215773, -225272.8087154911, -226993.02889387275], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [152858.2792939525, 138691.61262728582, 178308.84137708624, 192475.50804375293, 152858.2792939525], "y": [87218.58194424615, -14448.084722420517, -19968.518236736974, 81698.1484299297, 87218.58194424615], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [1823.2597836399307, -69140.9118456839, -68356.4470382215, 2607.7245911023547, 1823.2597836399307], "y": [-210458.8598779633, -214441.46658683146, -228419.47127154426, -224436.86456267608, -210458.8598779633], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4080148842815766)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4080148842815766)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-576.3463076227708], "y": [1264.726224215001], "mode": "markers+text", "marker": {"symbol": "star", "size": 40, "color": "yellow"}, "text": ["Nakkuti"], "textposition": "top center", "hovertext": ["Nakkuti [M11]"], "hoverinfo": "text", "meta": {"base_marker_size": 140, "base_text_size": 14}}, {"type": "scatter", "x": [-81960.40455442769], "y": [-142366.49010801828], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Charon Gate [E07]"], "hoverinfo": "text", "text": ["Charon Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [156687.20835233195], "y": [160766.06816720657], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Holtair Gate [U19]"], "hoverinfo": "text", "text": ["Holtair Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-187377.60646248283], "y": [116145.6977968362], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Jotar Gate [R02]"], "hoverinfo": "text", "text": ["Jotar Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-61562.2358892994], "y": [-114918.68792914202], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 97 [G08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-51243.82364911481], "y": [-124452.0035858343], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 80 [F09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-45523.834255099435], "y": [-137125.70557649582], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 57 [F09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-44963.05098117636], "y": [-152266.85397241884], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 23 [E09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-51580.29361346865], "y": [-165725.65254657267], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 55 [D09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-61450.079234514786], "y": [-174586.02827455726], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 69 [D08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-75693.9743921609], "y": [-178735.82450158804], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 14 [D08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-89937.86954980703], "y": [-178623.6678468034], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 39 [D07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-103396.66812396084], "y": [-171109.1719762342], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 54 [D06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-111359.79061366852], "y": [-159332.7232238496], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 68 [E06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-113715.08036414544], "y": [-144303.73148271118], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 71 [E06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-111359.7906136685], "y": [-129723.36636071121], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 27 [F06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-101826.47495697624], "y": [-118732.01419181893], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 22 [G06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-89377.08627588395], "y": [-111666.14494038819], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 48 [G07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-75357.50442780706], "y": [-110432.42173775741], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 34 [G08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-7321.497485034783], "y": [-187182.3123846099], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Brekka [C11]"], "hoverinfo": "text", "text": ["Brekka"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-232309.5304640014], "y": [-165890.39208854217], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Isa Aka [D00]"], "hoverinfo": "text", "text": ["**Isa Aka**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-108681.22385106137], "y": [-5480.544980631801], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Ri Ishi [L06]"], "hoverinfo": "text", "text": ["Ri Ishi"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-113528.28289114355], "y": [-11081.362204462856], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Throsc [L06]"], "hoverinfo": "text", "text": ["Throsc"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-194204.52203350308], "y": [158555.69901799646], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Vraknor [T02]"], "hoverinfo": "text", "text": ["Vraknor"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-176496.18870016976], "y": [146865.88420318163], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Ruktarn [T03]"], "hoverinfo": "text", "text": ["Ruktarn"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [139670.7397070715], "y": [140298.8534138862], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Krashnekk [T18]"], "hoverinfo": "text", "text": ["Krashnekk"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [144586.76921184055], "y": [128954.36142939611], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Mardruk [S19]"], "hoverinfo": "text", "text": ["Mardruk"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-120308.77417947145], "y": [-6832.148113961602], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 4 [L05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-110101.28450532122], "y": [-14856.077189774474], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 95 [L06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-103573.67730537482], "y": [-2692.769395806452], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 21 [L06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-10338.215592030529], "y": [-178055.49624092004], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 58 [D11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [141418.0311276798], "y": [129829.5773675911], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 93 [S19]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [140949.0877823587], "y": [138220.16344531055], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 12 [S19]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [258844.46223565275], "y": [-170936.74819176283], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Drengol [D24]"], "hoverinfo": "text", "text": ["**Drengol**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [258097.59778576953], "y": [-173623.41650318867], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 75 [D24]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [259880.4549449176], "y": [-169240.20077681032], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 78 [D24]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-168731.75135258527], "y": [104961.82387034365], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 56 [R03]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-178230.9833198921], "y": [-183068.78312554111], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 81 [C03]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-25137.615550116152], "y": [-182115.72242595264], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 35 [C10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-99187.36371014534], "y": [-3467.4183063072737], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 38 [L07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [125535.98124819963], "y": [135071.4923088438], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 71 [S18]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [195652.3649930556], "y": [169679.902802671], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 41 [U21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-211774.33253780863], "y": [133615.08798785618], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 75 [S01]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [195403.9572630876], "y": [-138014.62027681078], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 73 [F21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-237695.43908703048], "y": [-78003.75036170315], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 83 [I00]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-254962.10575369713], "y": [34496.249638296875], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 88 [N99]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-124728.77242036379], "y": [215096.2496382969], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 17 [W05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-10028.772420363748], "y": [238429.5829716302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 21 [X11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [101604.56091296951], "y": [226529.5829716302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 84 [X17]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [240871.22757963624], "y": [98662.91630496354], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 60 [Q24]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [257537.89424630292], "y": [20329.582971630203], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 12 [N24]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [240871.22757963624], "y": [-60503.75036170314], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 23 [I24]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [151364.1116674278], "y": [-204952.80300230673], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 10 [B19]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [79364.11166742777], "y": [-244952.80300230673], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 25 [Z15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-635.8883325722218], "y": [-261952.80300230673], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 43 [Y11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-103635.88833257221], "y": [-237952.80300230673], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 65 [A06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}], "layout": {"title": "Norayne", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Norayne';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Use Plotly's built-in nearest-point selection for accurate clicks
    plotDiv.on('plotly_click', function(ev) {
        if (!ev || !ev.points || !ev.points.length) return;
        var p = ev.points[0];
        var picked = null;
        // Prefer original name from hovertext: "Name [Grid]"
        if (p.hovertext && typeof p.hovertext === 'string') {
            picked = p.hovertext.split(' [')[0];
        } else if (p.text && typeof p.text === 'string') {
            // Fallback to text label (strip any ** used for GM marking)
            picked = p.text.replace(/\*/g, '');
        }
        if (picked && objData[picked]) {
            highlight(picked);
        }
    });

    // ——— Auto-scale markers based on current zoom/span (optimized: planets & blackholes only) ———
    (function() {
        var refSpan = null;
        var planetIdx = [];
        var bhIdx = [23];
        function rescaleMarkers() {
            try {
                var full = plotDiv._fullLayout || {};
                var xaxis = full.xaxis || (fig.layout && fig.layout.xaxis);
                if (!xaxis || !xaxis.range) return;
                var curr = Math.abs(xaxis.range[1] - xaxis.range[0]);
                if (!curr) return;
                if (!refSpan) refSpan = curr;
                var scale = refSpan / curr;
                var indices = [];
                var markerSizes = [];
                var textSizes = [];
                function pushForIndex(i) {
                    var t = fig.data[i];
                    if (!t || !t.meta || !t.meta.base_marker_size) return;
                    var base = t.meta.base_marker_size;
                    var baseText = t.meta.base_text_size || (t.textfont && t.textfont.size) || 12;
                    var newMarker = Math.max(2, Math.round(base * scale));
                    var newText = Math.max(8, Math.round(baseText * Math.sqrt(scale)));
                    indices.push(i);
                    markerSizes.push(newMarker);
                    textSizes.push(newText);
                }
                planetIdx.forEach(pushForIndex);
                bhIdx.forEach(pushForIndex);
                if (indices.length) {
                    Plotly.restyle(plotDiv, {'marker.size': [markerSizes], 'textfont.size': [textSizes]}, indices);
                }
            } catch (e) { console.error(e); }
        }
        // initial scale after plot settles
        setTimeout(rescaleMarkers, 250);
        plotDiv.on('plotly_relayout', rescaleMarkers);
    })();

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Charon Gate',function(){highlight('Charon Gate');},false,null,false)
    addButton('Holtair Gate',function(){highlight('Holtair Gate');},false,null,false)
    addButton('Jotar Gate',function(){highlight('Jotar Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

    addButton('--- Planets ---', null, true, null);
    

    addButton('--- Stations ---', null, true, null);
    addButton('Brekka',function(){highlight('Brekka');},false,'red',false)
    addButton('Drengol',function(){highlight('Drengol');},false,'red',true)
    addButton('Isa Aka',function(){highlight('Isa Aka');},false,'red',true)
    addButton('Krashnekk',function(){highlight('Krashnekk');},false,'red',false)
    addButton('Mardruk',function(){highlight('Mardruk');},false,'red',false)
    addButton('Ri Ishi',function(){highlight('Ri Ishi');},false,'red',false)
    addButton('Ruktarn',function(){highlight('Ruktarn');},false,'red',false)
    addButton('Throsc',function(){highlight('Throsc');},false,'red',false)
    addButton('Vraknor',function(){highlight('Vraknor');},false,'red',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>