
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ibroan.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        /* === Description typography controls ===
           Tweak these two variables to change description sizes globally */
        :root {
            --desc-font-size: 130%;
            --hull-desc-font-size: 130%;
        }
        .desc-text { font-size: var(--desc-font-size); margin-top: 8px; }
        .hull-desc { font-size: var(--hull-desc-font-size); margin-top: 5px; color: #ccc; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Ibroan</h2>
        <h3 class="subheader">Alignment: Torgoth</h3>
        <img src="Images/Factions/Torgoth.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Ukufa": {"type": "blackhole", "x": -109.24302477743865, "y": 0.0, "grid": "M11"}, "Planet Ya'anu": {"type": "planet", "x": -100402.221138625, "y": 135030.69875509283, "grid": "S06", "hidden": false}, "Setmari Gate": {"type": "jumpnode", "x": -24333.795591617087, "y": 44103.22521064717, "grid": "O10", "hidden": false, "label": "Setmari Gate", "destinations": {"Setmari Gate": "Setmari"}}, "Sumri Gate": {"type": "jumpnode", "x": 173529.052908014, "y": 49268.08631731512, "grid": "O20", "hidden": false, "label": "Sumri Gate", "destinations": {"Ibroan Gate": "Sumri"}}, "Uvizmai Control": {"type": "station", "x": 116872.50164867853, "y": 38161.38097514164, "grid": "N17", "hidden": false, "label": "Uvizmai Control", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "WP 51": {"type": "platform", "x": 169724.98400178782, "y": 55442.86078957544, "grid": "O20", "hidden": false, "label": "WP 51"}, "WP 34": {"type": "platform", "x": 171734.37186187014, "y": 42046.941722360076, "grid": "O20", "hidden": false, "label": "WP 34"}, "Ximni Smeltery": {"type": "station", "x": 134753.5976849154, "y": 169680.57941097463, "grid": "U18", "hidden": false, "label": "Ximni Smeltery", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "Ximni Ores": {"type": "station", "x": 129715.81637180943, "y": 158577.6864619205, "grid": "T18", "hidden": false, "label": "Ximni Ores", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "WP 28": {"type": "platform", "x": 136069.67942412285, "y": 162381.70844485966, "grid": "U18", "hidden": false, "label": "WP 28"}, "WP 91": {"type": "platform", "x": 128062.54104693703, "y": 166139.3394075822, "grid": "U18", "hidden": false, "label": "WP 91"}, "101100 Denabite": {"type": "station", "x": -4963.5082080033035, "y": 156674.4528768645, "grid": "T11", "hidden": false, "label": "101100 Denabite", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "WP 45": {"type": "platform", "x": -3121.98594888479, "y": 160989.46687466273, "grid": "U11", "hidden": false, "label": "WP 45"}, "WP 61": {"type": "platform", "x": -2561.202674961715, "y": 152016.9344918935, "grid": "T11", "hidden": false, "label": "WP 61"}, "WP 47": {"type": "platform", "x": -11085.108438592464, "y": 156166.73071892426, "grid": "T11", "hidden": false, "label": "WP 47"}, "E'yikanu Control": {"type": "station", "x": -76096.66558306945, "y": 115354.77282916689, "grid": "R08", "hidden": false, "label": "E'yikanu Control", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "Drenan Gate": {"type": "jumpnode", "x": -118342.03595343982, "y": -81983.1901337961, "grid": "H06", "hidden": false, "label": "Drenan Gate", "destinations": {"Ibroan Gate": "Drenan"}}, "Intas Base": {"type": "station", "x": -89985.55447195834, "y": -69830.41235601832, "grid": "I07", "hidden": false, "label": "Intas Base", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "Aunea Gas Systems": {"type": "station", "x": -3528.4299863616993, "y": -85272.0275823557, "grid": "H11", "hidden": false, "label": "Aunea Gas Systems", "hull": "hegemony_gasextractor", "facilities": [], "sides": ["Torgoth"], "hullName": "Gas Extractor", "hullImage": "Images/Ships/TSN Mod/Hegemony/GasExtractor256.png", "hullDescription": ""}, "Uttatt Command": {"type": "station", "x": 16854.964240152276, "y": -101188.22476110751, "grid": "G12", "hidden": false, "label": "Uttatt Command", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "Oorect Miners": {"type": "station", "x": 3953.942782672021, "y": -110101.75089971727, "grid": "G12", "hidden": false, "label": "Oorect Miners", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "WP 25": {"type": "platform", "x": 2667.090703493816, "y": -81512.64992678472, "grid": "H12", "hidden": false, "label": "WP 25"}, "WP 67": {"type": "platform", "x": 10660.080958997247, "y": -105494.28374090622, "grid": "G12", "hidden": false, "label": "WP 67"}, "WP 36": {"type": "platform", "x": -9731.750319166891, "y": -89683.33221359654, "grid": "H11", "hidden": false, "label": "WP 36"}, "WP 31": {"type": "platform", "x": 22362.63911270326, "y": -94985.88351103595, "grid": "H13", "hidden": false, "label": "WP 31"}, "WP 86": {"type": "platform", "x": -80850.57053362862, "y": 110721.26671457119, "grid": "R07", "hidden": false, "label": "WP 86"}, "WP 53": {"type": "platform", "x": -72323.07575704476, "y": 120411.60168796194, "grid": "S08", "hidden": false, "label": "WP 53"}, "Tu il Research": {"type": "station", "x": 21937.941519722655, "y": 26521.081434927008, "grid": "N13", "hidden": false, "label": "Tu il Research", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "KR 15": {"type": "station", "x": 107163.8093047142, "y": 53530.965451593416, "grid": "O17", "hidden": false, "label": "KR 15", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}, "SB 9": {"type": "station", "x": 130876.81870686327, "y": 26306.736818382018, "grid": "N18", "hidden": false, "label": "SB 9", "hull": "starbase_torgoth", "facilities": [], "sides": ["Torgoth"], "hullName": "Torgoth Base", "hullImage": "Images/Ships/torgoth_station256.png", "hullDescription": ""}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p class="hull-desc">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else if (obj.type === 'planet') {
            if (obj['class']) {
                infoHtml += '<b>Class:</b> ' + obj['class'] + '<br>';
            }
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p class="desc-text">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [5036.083773902285, -5058.015156713077, -5058.015156713077, 5036.083773902285, 5036.083773902285], "y": [22641.15006898989, 22641.15006898989, 16641.15006898989, 16641.15006898989, 22641.15006898989], "fill": "toself", "fillcolor": "rgba(165,42,42,1)", "line": {"shape": "spline", "color": "rgba(165,42,42,1)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [5596.867047825361, -5170.171811497692, -5170.171811497692, 5596.867047825361, 5596.867047825361], "y": [-16950.149069979252, -16950.149069979252, -22950.149069979252, -22950.149069979252, -16950.149069979252], "fill": "toself", "fillcolor": "rgba(165,42,42,0.9674588159999995)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.9674588159999995)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [22952.918860256097, 22952.918860256097, 16952.918860256097, 16952.918860256097, 22952.918860256097], "y": [-5706.25391233313, 6182.351494836075, 6182.351494836075, -5706.25391233313, -5706.25391233313], "fill": "toself", "fillcolor": "rgba(165,42,42,0.8761891163773581)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.8761891163773581)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-17087.169645023892, -16975.012990239276, -22974.6874958945, -23086.844150679117, -17087.169645023892], "y": [-4503.779014419318, 6263.259844903735, 6325.756454337644, -4441.282404985409, -4503.779014419318], "fill": "toself", "fillcolor": "rgba(165,42,42,0.9674063322710978)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.9674063322710978)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [15029.377782227242, 5047.435506396496, 2108.6590170080813, 12090.601292838826, 15029.377782227242], "y": [17433.924988807124, 23041.757728037883, 17810.735576926505, 12202.902837695749, 17433.924988807124], "fill": "toself", "fillcolor": "rgba(165,42,42,0.9098064713319522)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.9098064713319522)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [22848.619935134164, 15782.75068370341, 10664.288462654966, 17730.15771408572, 22848.619935134164], "y": [6065.356624164188, 17617.492066979547, 14486.782164784865, 2934.6467219695087, 6065.356624164188], "fill": "toself", "fillcolor": "rgba(165,42,42,0.769227401959807)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.769227401959807)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [18328.6223905088, 22927.045236678023, 17427.419102972635, 12828.99625680341, 18328.6223905088], "y": [-16102.48615510732, -5559.7606053535, -3160.9875044819983, -13703.713054235819, -16102.48615510732], "fill": "toself", "fillcolor": "rgba(165,42,42,0.9056445596182594)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.9056445596182594)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [5049.6438073804675, 18508.442381534285, 15789.562599747154, 2330.7640255933384, 5049.6438073804675], "y": [-23073.083671203414, -16231.527729341891, -10882.911765170487, -17724.46770703201, -23073.083671203414], "fill": "toself", "fillcolor": "rgba(165,42,42,0.6899420890581279)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.6899420890581279)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-17116.56052250861, -5676.581734477868, -2869.255411963672, -14309.234199994416, -17116.56052250861], "y": [-17217.99338935891, -23274.45274772813, -17971.72524964576, -11915.265891276542, -17217.99338935891], "fill": "toself", "fillcolor": "rgba(165,42,42,0.8047326222533977)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.8047326222533977)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-23153.7408360342, -17433.75144201883, -11973.223494361126, -17693.212888376496, -23153.7408360342], "y": [-4594.209364224708, -17155.754700101603, -14669.26429536461, -2107.7189594877173, -4594.209364224708], "fill": "toself", "fillcolor": "rgba(165,42,42,0.7546908432822618)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.7546908432822618)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-17627.24309934781, -23010.76252900933, -17611.877885832135, -12228.358456170612, -17627.24309934781], "y": [17248.8009806557, 6145.292156978801, 3527.6511178625847, 14631.159941539481, 17248.8009806557], "fill": "toself", "fillcolor": "rgba(165,42,42,0.8441533001387946)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.8441533001387946)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-5533.289277553882, -17646.207994292316, -15125.46658562609, -3012.547868887657, -5533.289277553882], "y": [23036.490719057103, 17428.65797982635, 11983.856537107304, 17591.68927633806, 23036.490719057103], "fill": "toself", "fillcolor": "rgba(165,42,42,0.7803883195745275)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.7803883195745275)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-1988.9248218460011, -18639.675870520856, -12097.30183182131, 4553.4492168535435, -1988.9248218460011], "y": [41447.14179275152, 17786.39245484538, 13182.335337720287, 36843.08467562643, 41447.14179275152], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [20261.603708883777, -2846.356682062732, 797.6368037423897, 23905.597194688897, 20261.603708883777], "y": [50876.25684734861, 41834.011476978245, 32521.58367992071, 41563.829050291075, 50876.25684734861], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [49638.229452150495, 19359.53728876273, 16770.112174480717, 47048.80433786848, 49638.229452150495], "y": [46395.93519135934, 52094.57276818395, 38336.12526937343, 32637.48769254882, 46395.93519135934], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [104533.59736517514, 50670.83944908003, 42769.48102468008, 96632.23894077519, 104533.59736517514], "y": [28394.102089947854, 51557.87881034109, 33184.84054637495, 10021.063825981713, 28394.102089947854], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [223784.53803124354, 106371.75969021046, 85348.16755081079, 202760.94589184388, 223784.53803124354], "y": [-81113.13611510594, 34228.33429018206, 12827.199424101407, -102514.2709811866, -81113.13611510594], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [250472.92939994315, 77966.49423496933, 53568.24782086669, 226074.68298584054, 250472.92939994315], "y": [-51739.16291916529, 81043.1367193125, 49345.7303283043, -83436.5693101735, -51739.16291916529], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [74981.65218476483, 18268.68922180184, 26460.497278478644, 83173.46024144161, 74981.65218476483], "y": [80682.86960039377, 55219.90663743081, 36974.51596574156, 62437.47892870452, 80682.86960039377], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-11214.829364554098, -22843.231332622992, -17604.04512053352, -5975.643152464625, -11214.829364554098], "y": [28720.490287965753, 7886.270095175649, 4962.073139590826, 25796.293332380934, 28720.490287965753], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4365802661112494)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4365802661112494)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-1289.0880780558996, -18247.174281489704, -11863.744866716674, 5094.341336717132, -1289.0880780558996], "y": [40490.27337656699, 18040.99735487843, 13218.982329330456, 35668.25835101902, 40490.27337656699], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [72800.82156022525, 12759.330066842693, 19469.31342104788, 79510.80491443042, 72800.82156022525], "y": [74850.6025904603, 53467.37079804148, 34626.56074681785, 56009.792539236674, 74850.6025904603], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [14831.908624314176, -3068.293479310399, 2038.5875664825867, 19938.789670107162, 14831.908624314176], "y": [52605.279660741326, 41972.82878715981, 33375.16829234377, 44007.61916592529, 52605.279660741326], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [79492.85021339361, 4863.68650425733, 6494.313094719739, 81123.47680385601, 79492.85021339361], "y": [56451.01045709412, 47699.13657237025, 33794.423093751684, 42546.296978475555, 56451.01045709412], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [101110.13748171368, 37758.603559674346, 30529.503875771403, 93881.03779781073, 101110.13748171368], "y": [30778.61224943732, 55337.797205998824, 36690.00597593101, 12130.821019369498, 30778.61224943732], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [249807.94026990753, 77176.65877461329, 64961.56579077953, 237592.84728607378, 249807.94026990753], "y": [-51917.39910782713, 81238.33162665824, 65401.93357039888, -67753.79716408649, -51917.39910782713], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [237854.02962418445, 83795.63175228986, 71068.71592695758, 225127.11379885217, 237854.02962418445], "y": [-67819.90142338024, 59265.80348377318, 43837.72474483402, -83247.9801623194, -67819.90142338024], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [225966.42280576663, 102870.58324085012, 82134.58233963187, 205230.42190454836, 225966.42280576663], "y": [-82136.59140851878, 35599.87831630724, 13919.973643438487, -103816.49608138754, -82136.59140851878], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [150163.06515942994, 123542.69478905955, 107770.05613632678, 134390.42650669717, 150163.06515942994], "y": [139949.60552732556, 174093.1240458441, 161795.81255388298, 127652.29403536442, 139949.60552732556], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-6145.200627007613, 11854.799372992387, -5703.112085295299, -23703.1120852953, -6145.200627007613], "y": [134112.01181697228, 167112.01181697228, 176689.05443058372, 143689.05443058372, 134112.01181697228], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [11970.809341111977, -2385.242471318761, -20682.22764414309, -6326.175831712352, 11970.809341111977], "y": [143381.1878497174, 175906.61773725576, 167830.707040285, 135305.27715274662, 143381.1878497174], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-100402.221138625], "y": [135030.69875509283], "mode": "markers+text", "marker": {"symbol": "circle", "size": 50, "color": "#98FB98"}, "text": ["Planet Ya'anu"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "hovertext": ["Planet Ya'anu [S06]"], "hoverinfo": "text", "meta": {"base_marker_size": 50, "base_text_size": 14}}, {"type": "scatter", "x": [56738.71022624872, -9927.956440417955, -35833.893244239574, 30832.773422427097, 56738.71022624872], "y": [-116230.514889718, -59563.848223051325, -90041.4209334297, -146708.0876000964, -116230.514889718], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [29524.982604458535, 20358.315937791864, -19453.498955782736, -10286.832289116066, 29524.982604458535], "y": [-147864.89137545595, -53698.224708789254, -57573.711114358455, -151740.37778102513, -147864.89137545595], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-109.24302477743865], "y": [0.0], "mode": "markers+text", "marker": {"symbol": "star", "size": 40, "color": "yellow"}, "text": ["Ukufa"], "textposition": "top center", "hovertext": ["Ukufa [M11]"], "hoverinfo": "text", "meta": {"base_marker_size": 140, "base_text_size": 14}}, {"type": "scatter", "x": [-24333.795591617087], "y": [44103.22521064717], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Setmari Gate [O10]"], "hoverinfo": "text", "text": ["Setmari Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [173529.052908014], "y": [49268.08631731512], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Sumri Gate [O20]"], "hoverinfo": "text", "text": ["Sumri Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [116872.50164867853], "y": [38161.38097514164], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Uvizmai Control [N17]"], "hoverinfo": "text", "text": ["Uvizmai Control"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [169724.98400178782], "y": [55442.86078957544], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 51 [O20]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [171734.37186187014], "y": [42046.941722360076], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 34 [O20]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [134753.5976849154], "y": [169680.57941097463], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Ximni Smeltery [U18]"], "hoverinfo": "text", "text": ["Ximni Smeltery"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [129715.81637180943], "y": [158577.6864619205], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Ximni Ores [T18]"], "hoverinfo": "text", "text": ["Ximni Ores"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [136069.67942412285], "y": [162381.70844485966], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 28 [U18]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [128062.54104693703], "y": [166139.3394075822], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 91 [U18]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-4963.5082080033035], "y": [156674.4528768645], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["101100 Denabite [T11]"], "hoverinfo": "text", "text": ["101100 Denabite"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-3121.98594888479], "y": [160989.46687466273], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 45 [U11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-2561.202674961715], "y": [152016.9344918935], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 61 [T11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-11085.108438592464], "y": [156166.73071892426], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 47 [T11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-76096.66558306945], "y": [115354.77282916689], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["E'yikanu Control [R08]"], "hoverinfo": "text", "text": ["E'yikanu Control"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-118342.03595343982], "y": [-81983.1901337961], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Drenan Gate [H06]"], "hoverinfo": "text", "text": ["Drenan Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-89985.55447195834], "y": [-69830.41235601832], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Intas Base [I07]"], "hoverinfo": "text", "text": ["Intas Base"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-3528.4299863616993], "y": [-85272.0275823557], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Aunea Gas Systems [H11]"], "hoverinfo": "text", "text": ["Aunea Gas Systems"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [16854.964240152276], "y": [-101188.22476110751], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Uttatt Command [G12]"], "hoverinfo": "text", "text": ["Uttatt Command"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [3953.942782672021], "y": [-110101.75089971727], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Oorect Miners [G12]"], "hoverinfo": "text", "text": ["Oorect Miners"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [2667.090703493816], "y": [-81512.64992678472], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 25 [H12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [10660.080958997247], "y": [-105494.28374090622], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 67 [G12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-9731.750319166891], "y": [-89683.33221359654], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 36 [H11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [22362.63911270326], "y": [-94985.88351103595], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 31 [H13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-80850.57053362862], "y": [110721.26671457119], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 86 [R07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-72323.07575704476], "y": [120411.60168796194], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 53 [S08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [21937.941519722655], "y": [26521.081434927008], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Tu il Research [N13]"], "hoverinfo": "text", "text": ["Tu il Research"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [107163.8093047142], "y": [53530.965451593416], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["KR 15 [O17]"], "hoverinfo": "text", "text": ["KR 15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [130876.81870686327], "y": [26306.736818382018], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["SB 9 [N18]"], "hoverinfo": "text", "text": ["SB 9"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}], "layout": {"title": "Ibroan", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Ibroan';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Use Plotly's built-in nearest-point selection for accurate clicks
    plotDiv.on('plotly_click', function(ev) {
        if (!ev || !ev.points || !ev.points.length) return;
        var p = ev.points[0];
        var picked = null;
        // Prefer original name from hovertext: "Name [Grid]"
        if (p.hovertext && typeof p.hovertext === 'string') {
            picked = p.hovertext.split(' [')[0];
        } else if (p.text && typeof p.text === 'string') {
            // Fallback to text label (strip any ** used for GM marking)
            picked = p.text.replace(/\*/g, '');
        }
        if (picked && objData[picked]) {
            highlight(picked);
        }
    });

    // ——— Auto-scale markers based on current zoom/span (optimized: planets & blackholes only) ———
    (function() {
        var refSpan = null;
        var planetIdx = [31];
        var bhIdx = [34];
        function rescaleMarkers() {
            try {
                var full = plotDiv._fullLayout || {};
                var xaxis = full.xaxis || (fig.layout && fig.layout.xaxis);
                if (!xaxis || !xaxis.range) return;
                var curr = Math.abs(xaxis.range[1] - xaxis.range[0]);
                if (!curr) return;
                if (!refSpan) refSpan = curr;
                var scale = refSpan / curr;
                var indices = [];
                var markerSizes = [];
                var textSizes = [];
                function pushForIndex(i) {
                    var t = fig.data[i];
                    if (!t || !t.meta || !t.meta.base_marker_size) return;
                    var base = t.meta.base_marker_size;
                    var baseText = t.meta.base_text_size || (t.textfont && t.textfont.size) || 12;
                    var newMarker = Math.max(2, Math.round(base * scale));
                    var newText = Math.max(8, Math.round(baseText * Math.sqrt(scale)));
                    indices.push(i);
                    markerSizes.push(newMarker);
                    textSizes.push(newText);
                }
                planetIdx.forEach(pushForIndex);
                bhIdx.forEach(pushForIndex);
                if (indices.length) {
                    Plotly.restyle(plotDiv, {'marker.size': [markerSizes], 'textfont.size': [textSizes]}, indices);
                }
            } catch (e) { console.error(e); }
        }
        // initial scale after plot settles
        setTimeout(rescaleMarkers, 250);
        plotDiv.on('plotly_relayout', rescaleMarkers);
    })();

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Drenan Gate',function(){highlight('Drenan Gate');},false,null,false)
    addButton('Setmari Gate',function(){highlight('Setmari Gate');},false,null,false)
    addButton('Sumri Gate',function(){highlight('Sumri Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

    addButton('--- Planets ---', null, true, null);
    addButton('Planet Ya'anu',function(){highlight('Planet Ya'anu');},false,null,false)

    addButton('--- Stations ---', null, true, null);
    addButton('101100 Denabite',function(){highlight('101100 Denabite');},false,'red',false)
    addButton('Aunea Gas Systems',function(){highlight('Aunea Gas Systems');},false,'red',false)
    addButton('E'yikanu Control',function(){highlight('E'yikanu Control');},false,'red',false)
    addButton('Intas Base',function(){highlight('Intas Base');},false,'red',false)
    addButton('KR 15',function(){highlight('KR 15');},false,'red',false)
    addButton('Oorect Miners',function(){highlight('Oorect Miners');},false,'red',false)
    addButton('SB 9',function(){highlight('SB 9');},false,'red',false)
    addButton('Tu il Research',function(){highlight('Tu il Research');},false,'red',false)
    addButton('Uttatt Command',function(){highlight('Uttatt Command');},false,'red',false)
    addButton('Uvizmai Control',function(){highlight('Uvizmai Control');},false,'red',false)
    addButton('Ximni Ores',function(){highlight('Ximni Ores');},false,'red',false)
    addButton('Ximni Smeltery',function(){highlight('Ximni Smeltery');},false,'red',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>