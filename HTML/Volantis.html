
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volantis.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Volantis</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Volantis Command": {"type": "station", "x": -33622.006336373364, "y": -40568.07193738892, "grid": "J10", "hidden": false, "label": "Volantis Command", "hull": "starbase_command", "facilities": [], "sides": ["TSN"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Station": {"type": "station", "x": -30796.50633637336, "y": -39111.62662488892, "grid": "K10", "hidden": false, "label": "Station", "hull": "starbase_industry", "facilities": [], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "Waypoint 52": {"type": "jump_point", "x": 109345.49366362664, "y": -85753.95084363893, "grid": "H17", "hidden": false, "label": "Waypoint 52"}, "Promethean": {"type": "jump_point", "x": -53521.506336373364, "y": 56030.04915636108, "grid": "O09", "hidden": false, "label": "Promethean"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p style="margin-top:5px; font-size:90%; color:#ccc;">' + obj.hullDescription + '</p>';
            }
        } else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
            infoHtml += '<b>Type:</b> ' + obj.type + '<br>';
            infoHtml += '<b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p style="font-size:90%; margin-top:8px;">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [38168.25580635573, 89983.25580635572, 99699.73152089755, 47884.73152089754, 38168.25580635573], "y": [-22772.495047895463, -70156.49504789547, -59531.40663938238, -12147.40663938238, -22772.495047895463], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-36280.99602614992, -36476.99602614992, -28338.016646596796, -28142.016646596796, -36280.99602614992], "y": [25053.49808809962, 12677.49808809962, 12548.600224622534, 24924.600224622536, 25053.49808809962], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-36428.85392008941, -35908.85392008941, -27776.158752657317, -28296.158752657317, -36428.85392008941], "y": [36433.662009489046, 24167.662009489046, 24512.43630323311, 36778.43630323311, 36433.662009489046], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-44872.375348160276, -37180.375348160276, -32494.637324586452, -40186.63732458645, -44872.375348160276], "y": [23684.0069700887, 18269.0069700887, 24925.091342633455, 30340.091342633455, 23684.0069700887], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-51355.6243988757, -43898.6243988757, -44392.38827387103, -51849.38827387103, -51355.6243988757], "y": [20148.401927782492, 20957.401927782492, 25508.696384939663, 24699.696384939663, 20148.401927782492], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [66397.35537760427, 102716.35537760427, 103768.631949649, 67449.631949649, 66397.35537760427], "y": [-67406.51623269798, -74860.51623269798, -69733.38545457988, -62279.38545457988, -67406.51623269798], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-12008.080675467216, -26569.080675467216, -27879.931997279506, -13318.931997279506, -12008.080675467216], "y": [-49239.228297680536, -46172.228297680536, -52395.67338959731, -55462.67338959731, -49239.228297680536], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4596366873740089)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4596366873740089)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-32604.265021662635, -47009.265021662635, -49527.74765108409, -35122.74765108409, -32604.265021662635], "y": [-46595.897537391655, -40383.897537391655, -46224.00414988619, -52436.00414988619, -46595.897537391655], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4359960336060656)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4359960336060656)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-83133.03654998525, -48069.03654998525, -43593.97612276148, -78657.97612276148, -83133.03654998525], "y": [-70570.77727027879, -81249.77727027879, -66556.12441699907, -55877.12441699906, -70570.77727027879], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-24682.598330717123, -27494.598330717123, -33466.4143420296, -30654.4143420296, -24682.598330717123], "y": [-67024.84663717813, -49239.84663717813, -50184.05505009973, -67969.05505009973, -67024.84663717813], "fill": "toself", "fillcolor": "rgba(128,0,128,0.43632477487587196)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.43632477487587196)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-32591.39658401046, -41859.39658401046, -43553.61608873627, -34285.61608873627, -32591.39658401046], "y": [-72892.27010272123, -70321.27010272123, -76428.63158455663, -78999.63158455663, -72892.27010272123], "fill": "toself", "fillcolor": "rgba(128,0,128,0.5167419082886658)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.5167419082886658)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-59797.23902384183, -45773.23902384183, -45173.7736489049, -59197.7736489049, -59797.23902384183], "y": [-71482.32905362376, -73611.32905362376, -69662.5726336541, -67533.5726336541, -71482.32905362376], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-34098.485579327964, -36779.485579327964, -33959.527093418765, -31278.527093418765, -34098.485579327964], "y": [27956.219680651746, 24236.219680651746, 22203.87863207041, 25923.87863207041, 27956.219680651746], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-60885.76615797904, -58585.76615797904, -55505.24651476769, -57805.24651476769, -60885.76615797904], "y": [25029.913340521747, 20629.913340521747, 22240.184972200408, 26640.184972200408, 25029.913340521747], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-56995.17458247041, -51221.17458247041, -50477.83809027632, -56251.83809027632, -56995.17458247041], "y": [20486.254494205743, 19222.254494205743, 22617.843818516412, 23881.843818516412, 20486.254494205743], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-33622.006336373364], "y": [-40568.07193738892], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "green"}, "hovertext": ["Volantis Command [J10]"], "hoverinfo": "text", "text": ["Volantis Command"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-33622.006336373364], "y": [-40568.07193738892], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "green"}, "hovertext": ["Volantis Command [J10]"], "hoverinfo": "text", "text": ["Volantis Command"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-30796.50633637336], "y": [-39111.62662488892], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Station [K10]"], "hoverinfo": "text", "text": ["Station"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-30796.50633637336], "y": [-39111.62662488892], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Station [K10]"], "hoverinfo": "text", "text": ["Station"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [109345.49366362664], "y": [-85753.95084363893], "mode": "markers+text", "marker": {"symbol": "circle", "size": 12, "color": "white"}, "hovertext": ["Waypoint 52 [H17]"], "hoverinfo": "text", "text": ["Waypoint 52"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [109345.49366362664], "y": [-85753.95084363893], "mode": "markers+text", "marker": {"symbol": "circle", "size": 12, "color": "white"}, "hovertext": ["Waypoint 52 [H17]"], "hoverinfo": "text", "text": ["Waypoint 52"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-53521.506336373364], "y": [56030.04915636108], "mode": "markers+text", "marker": {"symbol": "circle", "size": 12, "color": "white"}, "hovertext": ["Promethean [O09]"], "hoverinfo": "text", "text": ["Promethean"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-53521.506336373364], "y": [56030.04915636108], "mode": "markers+text", "marker": {"symbol": "circle", "size": 12, "color": "white"}, "hovertext": ["Promethean [O09]"], "hoverinfo": "text", "text": ["Promethean"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}], "layout": {"title": "Volantis", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Volantis';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Custom click: select nearest object within 10px of cursor
    plotDiv.addEventListener('click', function(evt) {
        var rect = plotDiv.getBoundingClientRect();
        var px = evt.clientX - rect.left;
        var py = evt.clientY - rect.top;
        var xaxis = plotDiv._fullLayout.xaxis;
        var yaxis = plotDiv._fullLayout.yaxis;
        var l2px = xaxis.l2p.bind(xaxis);
        var l2py = yaxis.l2p.bind(yaxis);
        var minDist = Infinity, closest = null;
        for (var name in objData) {
            var pt = objData[name];
            var xPx = l2px(pt.x);
            var yPx = l2py(pt.y);
            var dx = xPx - px, dy = yPx - py;
            var d = Math.sqrt(dx*dx + dy*dy);
            console.log(`${name}: data=(${pt.x}, ${pt.y}) -> screen=(${xPx.toFixed(1)}, ${yPx.toFixed(1)}), cursor=(${px.toFixed(1)}, ${py.toFixed(1)}), dx=${dx.toFixed(1)}, dy=${dy.toFixed(1)}, d=${d.toFixed(1)}`);
            if (d < minDist) {
                minDist = d;
                closest = name;
            }
        }
        if (minDist <= 35 && closest) {
            highlight(closest);
        }
    });

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  

  addButton('--- Nav Points/POI ---', null, true, null);
  

  addButton('--- Stations ---', null, true, null);
  addButton('Station',function(){highlight('Station');},false,'blue',false)
    addButton('Volantis Command',function(){highlight('Volantis Command');},false,'green',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>