
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phinmor.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        /* === Description typography controls ===
           Tweak these two variables to change description sizes globally */
        :root {
            --desc-font-size: 130%;
            --hull-desc-font-size: 130%;
        }
        .desc-text { font-size: var(--desc-font-size); margin-top: 8px; }
        .hull-desc { font-size: var(--hull-desc-font-size); margin-top: 5px; color: #ccc; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Phinmor</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Phinmor IV": {"type": "planet", "x": 106206.9170953361, "y": -315711.12600022857, "grid": "W17", "hidden": false}, "Mesa Gate": {"type": "jumpnode", "x": 188500.0, "y": -53666.666666666744, "grid": "J21", "hidden": false, "label": "Mesa Gate", "destinations": {"Lightening Gate": "Ashia", "Ornate": "Tyr"}}, "Munro Gap": {"type": "jumpnode", "x": -220000.0, "y": 222533.33333333328, "grid": "X01", "hidden": false, "label": "Munro Gap", "destinations": {"Sashar Gate": "Waypoint 46"}}, "Phinmor Oasis": {"type": "station", "x": 77182.42578303615, "y": -283337.65492112475, "grid": "X15", "hidden": false, "label": "Phinmor Oasis", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 111": {"type": "station", "x": 115974.77474851398, "y": -274686.12385688146, "grid": "Y17", "hidden": false, "label": "DS 111", "hull": "starbase_civil", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Loags Denibite": {"type": "station", "x": -112234.26231710095, "y": -169858.05601280284, "grid": "D06", "hidden": false, "label": "Loags Denibite", "hull": "usfp_industrial_refinary", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Refinary Unit", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialRefinary256.png", "hullDescription": ""}, "LD SM1": {"type": "station", "x": -105857.04077757445, "y": -178097.36239791312, "grid": "D06", "hidden": false, "label": "LD SM1", "hull": "usfp_industrial_storage", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Storage Module", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialStorage256.png", "hullDescription": ""}, "LD SM2": {"type": "station", "x": -126206.74422169503, "y": -173446.00161068555, "grid": "D05", "hidden": false, "label": "LD SM2", "hull": "usfp_industrial_storage", "facilities": [], "sides": ["USFP"], "hullName": "Storage Module", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialStorage256.png", "hullDescription": ""}, "Argos Cantina": {"type": "station", "x": -7500.620718862551, "y": 70021.83002464053, "grid": "P11", "hidden": false, "label": "Argos Cantina", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Mighty Mineing Sela": {"type": "station", "x": 130201.50583863627, "y": 306863.32712874055, "grid": "B18", "hidden": false, "label": "Mighty Mineing Sela", "hull": "starbase_industry", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "MM Smeltery 1224": {"type": "station", "x": 210049.46394334588, "y": 260750.62994081184, "grid": "Z22", "hidden": false, "label": "MM Smeltery 1224", "hull": "usfp_industrial_processor", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Processor Unit", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialProcessor256.png", "hullDescription": ""}, "Master Mining Inc": {"type": "station", "x": 57441.18919483192, "y": 353338.0427780317, "grid": "D14", "hidden": false, "label": "Master Mining Inc", "hull": "starbase_industry", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "DS 133": {"type": "station", "x": 201197.0833992215, "y": 362002.6125368338, "grid": "E22", "hidden": false, "label": "DS 133", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Modei Shipping": {"type": "station", "x": 4446.090910462145, "y": 83222.84978153733, "grid": "Q12", "hidden": false, "label": "Modei Shipping", "hull": "starbase_command", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "SR 13": {"type": "sensor_relay", "x": 151206.9170953361, "y": -316827.45258916315, "grid": "W19", "hidden": false, "label": "SR 13"}, "SR 83": {"type": "sensor_relay", "x": 134263.9581789791, "y": -281645.03587810183, "grid": "X18", "hidden": false, "label": "SR 83"}, "SR 97": {"type": "sensor_relay", "x": 96193.47506730196, "y": -272955.69654098107, "grid": "Y16", "hidden": false, "label": "SR 97"}, "SR 26": {"type": "sensor_relay", "x": 65663.31803972725, "y": -297302.68432887306, "grid": "X15", "hidden": false, "label": "SR 26"}, "SR 79": {"type": "sensor_relay", "x": 65663.31803972725, "y": -336352.22084945324, "grid": "V15", "hidden": false, "label": "SR 79"}, "SR 59": {"type": "sensor_relay", "x": 96193.47506730194, "y": -360699.20863734523, "grid": "T16", "hidden": false, "label": "SR 59"}, "SR 88": {"type": "sensor_relay", "x": 134263.9581789791, "y": -352009.86930022447, "grid": "U18", "hidden": false, "label": "SR 88"}, "SR 35": {"type": "sensor_relay", "x": -238761.3620065538, "y": 242164.24391606977, "grid": "Y00", "hidden": false, "label": "SR 35"}, "SR 37": {"type": "sensor_relay", "x": -202061.3620065538, "y": 216564.24391606977, "grid": "W01", "hidden": false, "label": "SR 37"}, "SR 86": {"type": "sensor_relay", "x": -165361.3620065538, "y": 190964.24391606977, "grid": "V03", "hidden": false, "label": "SR 86"}, "SR 33": {"type": "sensor_relay", "x": -128661.3620065538, "y": 165364.24391606977, "grid": "U05", "hidden": false, "label": "SR 33"}, "SR 89": {"type": "sensor_relay", "x": -91961.3620065538, "y": 139764.24391606977, "grid": "S07", "hidden": false, "label": "SR 89"}, "SR 74": {"type": "sensor_relay", "x": -55261.3620065538, "y": 114164.24391606977, "grid": "R09", "hidden": false, "label": "SR 74"}, "SR 42": {"type": "sensor_relay", "x": -18561.362006553798, "y": 88564.24391606977, "grid": "Q11", "hidden": false, "label": "SR 42"}, "SR 91": {"type": "sensor_relay", "x": 18138.63799344623, "y": 62964.24391606977, "grid": "P12", "hidden": false, "label": "SR 91"}, "SR 20": {"type": "sensor_relay", "x": 54838.6379934462, "y": 37364.24391606977, "grid": "N14", "hidden": false, "label": "SR 20"}, "SR 48": {"type": "sensor_relay", "x": 91538.6379934462, "y": 11764.243916069769, "grid": "M16", "hidden": false, "label": "SR 48"}, "SR 63": {"type": "sensor_relay", "x": 128238.6379934462, "y": -13835.756083930231, "grid": "L18", "hidden": false, "label": "SR 63"}, "SR 45": {"type": "sensor_relay", "x": 164938.6379934462, "y": -39435.75608393023, "grid": "K20", "hidden": false, "label": "SR 45"}, "SR 23": {"type": "sensor_relay", "x": 201638.6379934462, "y": -65035.75608393023, "grid": "I22", "hidden": false, "label": "SR 23"}, "SR 15": {"type": "sensor_relay", "x": 105638.63799344617, "y": -253435.7560839302, "grid": "Z17", "hidden": false, "label": "SR 15"}, "SR 36": {"type": "sensor_relay", "x": 91988.63799344617, "y": -212035.7560839302, "grid": "B16", "hidden": false, "label": "SR 36"}, "SR 84": {"type": "sensor_relay", "x": 78338.63799344617, "y": -170635.7560839302, "grid": "D15", "hidden": false, "label": "SR 84"}, "SR 14": {"type": "sensor_relay", "x": 64688.63799344617, "y": -129235.7560839302, "grid": "F15", "hidden": false, "label": "SR 14"}, "SR 24": {"type": "sensor_relay", "x": 51038.63799344617, "y": -87835.7560839302, "grid": "H14", "hidden": false, "label": "SR 24"}, "SR 30": {"type": "sensor_relay", "x": 37388.63799344617, "y": -46435.7560839302, "grid": "J13", "hidden": false, "label": "SR 30"}, "SR 61": {"type": "sensor_relay", "x": 23738.637993446173, "y": -5035.756083930202, "grid": "L13", "hidden": false, "label": "SR 61"}, "SR 56": {"type": "sensor_relay", "x": 10088.637993446173, "y": 36364.2439160698, "grid": "N12", "hidden": false, "label": "SR 56"}, "SR 57": {"type": "sensor_relay", "x": -3561.362006553827, "y": 77764.2439160698, "grid": "P11", "hidden": false, "label": "SR 57"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p class="hull-desc">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else if (obj.type === 'planet') {
            if (obj['class']) {
                infoHtml += '<b>Class:</b> ' + obj['class'] + '<br>';
            }
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p class="desc-text">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [106206.9170953361], "y": [-315711.12600022857], "mode": "markers+text", "marker": {"symbol": "circle", "size": 50, "color": "#98FB98"}, "text": ["Phinmor IV"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "hovertext": ["Phinmor IV [W17]"], "hoverinfo": "text", "meta": {"base_marker_size": 50, "base_text_size": 14}}, {"type": "scatter", "x": [-93855.14910899916, -132744.03799788805, -130613.37552520273, -91724.48663631386, -93855.14910899916], "y": [-145331.6311402714, -149498.2978069381, -169384.48088533428, -165217.8142186676, -145331.6311402714], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-177382.6874304785, -198382.6874304785, -246889.81243774507, -225889.81243774507, -177382.6874304785], "y": [129066.00316274213, 213066.00316274213, 200939.22191092547, 116939.22191092547, 129066.00316274213], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-130721.78616462192, -186721.78616462194, -230550.71370360162, -174550.71370360162, -130721.78616462192], "y": [58034.082841651754, 160034.08284165175, 135971.14223201585, 33971.14223201584, 58034.082841651754], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-45826.83768630526, -143826.83768630525, -175445.6621819183, -77445.6621819183, -45826.83768630526], "y": [-630.8574596032231, 79369.14254039677, 40636.08253327082, -39363.91746672918, -630.8574596032231], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [29049.73359116276, -61950.26640883723, -83322.23345938632, 7677.766540613671, 29049.73359116276], "y": [-28844.423158404687, 13155.576841595313, -33150.35176792772, -75150.35176792773, -28844.423158404687], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [154180.71522119374, -77946.92373358336, -103580.85404419439, 128546.7849105827, 154180.71522119374], "y": [-36376.0390460695, 95144.49656524492, 49901.79973105149, -81618.73588026292, -36376.0390460695], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-89383.46121308557, -187383.46121308557, -181889.038655138, -83889.03865513799, -89383.46121308557], "y": [282617.852013242, 254617.85201324202, 235387.37306042557, 263387.37306042557, 282617.852013242], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-9933.148694050722, -110933.14869405072, -110339.35117417284, -9339.351174172838, -9933.148694050722], "y": [282998.20412144484, 279998.20412144484, 260007.02095222278, 263007.02095222275, 282998.20412144484], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [73812.14317415001, -25187.85682584998, -30084.643042373602, 68915.3569576264, 73812.14317415001], "y": [258698.24924555057, 283698.24924555054, 264306.97582811705, 239306.97582811702, 258698.24924555057], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [128508.70762016348, 58508.70762016347, 48218.79251161294, 118218.79251161293, 128508.70762016348], "y": [222577.54179395924, 264577.5417939592, 247427.68327970835, 205427.68327970835, 222577.54179395924], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [175868.66271875947, 116868.66271875947, 101858.83741301697, 160858.83741301697, 175868.66271875947], "y": [160611.4162162279, 227611.4162162279, 214393.8088574397, 147393.8088574397, 160611.4162162279], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [207003.67624794896, 175003.67624794896, 155723.82388382748, 187723.82388382748, 207003.67624794896], "y": [48661.90251809193, 164661.90251809193, 159343.32255557567, 43343.322555575665, 48661.90251809193], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [196279.09467910975, 207279.09467910975, 187448.4054526667, 176448.4054526667, 196279.09467910975], "y": [-18295.825448230928, 65704.17455176907, 68301.05052189852, -15698.94947810148, -18295.825448230928], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [193543.8746692437, 38124.12158282399, 29488.03094727836, 184907.7840336981, 193543.8746692437], "y": [322697.804896208, 397102.8974888006, 379063.55330630206, 304658.4607137095, 322697.804896208], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [155805.5185441969, 156787.00002567837, 136788.11546738684, 135806.63398590538, 155805.5185441969], "y": [265977.61239630514, 358904.3099271694, 359115.53592966165, 266188.8383987974, 265977.61239630514], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [95681.8793284023, 81681.8793284023, 61930.27320170002, 75930.27320170002, 95681.8793284023], "y": [284654.37588490255, 372654.37588490255, 369512.07491019997, 281512.07491019997, 284654.37588490255], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [160541.05997060722, 75680.72046443443, 81931.43206566792, 166791.77157184074, 160541.05997060722], "y": [341502.8106276969, 313582.2859363388, 294584.1648587637, 322504.6895501218, 341502.8106276969], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [194484.5143625357, 110572.47732549865, 99090.60113052951, 183002.6381675666, 194484.5143625357], "y": [330546.5836798775, 389381.4602230874, 373005.66958436096, 314170.7930411511, 330546.5836798775], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [139925.21316437243, 97925.21316437243, 70887.3335986975, 112887.3335986975, 139925.21316437243], "y": [343236.16269539297, 370236.16269539297, 328177.2389265653, 301177.2389265653, 343236.16269539297], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-35161.514513663606, -246841.5145136636, -281579.2677085587, -69899.2677085587, -35161.514513663606], "y": [-225105.89373283842, -88305.89373283842, -142057.99604493924, -278857.99604493927, -225105.89373283842], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [188500.0], "y": [-53666.666666666744], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Mesa Gate [J21]"], "hoverinfo": "text", "text": ["Mesa Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-220000.0], "y": [222533.33333333328], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Munro Gap [X01]"], "hoverinfo": "text", "text": ["Munro Gap"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [77182.42578303615], "y": [-283337.65492112475], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Phinmor Oasis [X15]"], "hoverinfo": "text", "text": ["Phinmor Oasis"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [115974.77474851398], "y": [-274686.12385688146], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 111 [Y17]"], "hoverinfo": "text", "text": ["DS 111"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-112234.26231710095], "y": [-169858.05601280284], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Loags Denibite [D06]"], "hoverinfo": "text", "text": ["Loags Denibite"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-105857.04077757445], "y": [-178097.36239791312], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["LD SM1 [D06]"], "hoverinfo": "text", "text": ["LD SM1"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-126206.74422169503], "y": [-173446.00161068555], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["LD SM2 [D05]"], "hoverinfo": "text", "text": ["LD SM2"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-7500.620718862551], "y": [70021.83002464053], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Argos Cantina [P11]"], "hoverinfo": "text", "text": ["Argos Cantina"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [130201.50583863627], "y": [306863.32712874055], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Mighty Mineing Sela [B18]"], "hoverinfo": "text", "text": ["Mighty Mineing Sela"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [210049.46394334588], "y": [260750.62994081184], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["MM Smeltery 1224 [Z22]"], "hoverinfo": "text", "text": ["MM Smeltery 1224"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [57441.18919483192], "y": [353338.0427780317], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Master Mining Inc [D14]"], "hoverinfo": "text", "text": ["Master Mining Inc"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [201197.0833992215], "y": [362002.6125368338], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 133 [E22]"], "hoverinfo": "text", "text": ["DS 133"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [4446.090910462145], "y": [83222.84978153733], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Modei Shipping [Q12]"], "hoverinfo": "text", "text": ["Modei Shipping"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [151206.9170953361], "y": [-316827.45258916315], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 13 [W19]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [134263.9581789791], "y": [-281645.03587810183], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 83 [X18]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [96193.47506730196], "y": [-272955.69654098107], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 97 [Y16]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [65663.31803972725], "y": [-297302.68432887306], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 26 [X15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [65663.31803972725], "y": [-336352.22084945324], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 79 [V15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [96193.47506730194], "y": [-360699.20863734523], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 59 [T16]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [134263.9581789791], "y": [-352009.86930022447], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 88 [U18]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-238761.3620065538], "y": [242164.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 35 [Y00]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-202061.3620065538], "y": [216564.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 37 [W01]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-165361.3620065538], "y": [190964.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 86 [V03]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-128661.3620065538], "y": [165364.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 33 [U05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-91961.3620065538], "y": [139764.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 89 [S07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-55261.3620065538], "y": [114164.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 74 [R09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-18561.362006553798], "y": [88564.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 42 [Q11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [18138.63799344623], "y": [62964.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 91 [P12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [54838.6379934462], "y": [37364.24391606977], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 20 [N14]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [91538.6379934462], "y": [11764.243916069769], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 48 [M16]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [128238.6379934462], "y": [-13835.756083930231], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 63 [L18]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [164938.6379934462], "y": [-39435.75608393023], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 45 [K20]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [201638.6379934462], "y": [-65035.75608393023], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 23 [I22]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [105638.63799344617], "y": [-253435.7560839302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 15 [Z17]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [91988.63799344617], "y": [-212035.7560839302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 36 [B16]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [78338.63799344617], "y": [-170635.7560839302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 84 [D15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [64688.63799344617], "y": [-129235.7560839302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 14 [F15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [51038.63799344617], "y": [-87835.7560839302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 24 [H14]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [37388.63799344617], "y": [-46435.7560839302], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 30 [J13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [23738.637993446173], "y": [-5035.756083930202], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 61 [L13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [10088.637993446173], "y": [36364.2439160698], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 56 [N12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-3561.362006553827], "y": [77764.2439160698], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 57 [P11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}], "layout": {"title": "Phinmor", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Phinmor';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Use Plotly's built-in nearest-point selection for accurate clicks
    plotDiv.on('plotly_click', function(ev) {
        if (!ev || !ev.points || !ev.points.length) return;
        var p = ev.points[0];
        var picked = null;
        // Prefer original name from hovertext: "Name [Grid]"
        if (p.hovertext && typeof p.hovertext === 'string') {
            picked = p.hovertext.split(' [')[0];
        } else if (p.text && typeof p.text === 'string') {
            // Fallback to text label (strip any ** used for GM marking)
            picked = p.text.replace(/\*/g, '');
        }
        if (picked && objData[picked]) {
            highlight(picked);
        }
    });

    // ——— Auto-scale markers based on current zoom/span (optimized: planets & blackholes only) ———
    (function() {
        var refSpan = null;
        var planetIdx = [0];
        var bhIdx = [];
        function rescaleMarkers() {
            try {
                var full = plotDiv._fullLayout || {};
                var xaxis = full.xaxis || (fig.layout && fig.layout.xaxis);
                if (!xaxis || !xaxis.range) return;
                var curr = Math.abs(xaxis.range[1] - xaxis.range[0]);
                if (!curr) return;
                if (!refSpan) refSpan = curr;
                var scale = refSpan / curr;
                var indices = [];
                var markerSizes = [];
                var textSizes = [];
                function pushForIndex(i) {
                    var t = fig.data[i];
                    if (!t || !t.meta || !t.meta.base_marker_size) return;
                    var base = t.meta.base_marker_size;
                    var baseText = t.meta.base_text_size || (t.textfont && t.textfont.size) || 12;
                    var newMarker = Math.max(2, Math.round(base * scale));
                    var newText = Math.max(8, Math.round(baseText * Math.sqrt(scale)));
                    indices.push(i);
                    markerSizes.push(newMarker);
                    textSizes.push(newText);
                }
                planetIdx.forEach(pushForIndex);
                bhIdx.forEach(pushForIndex);
                if (indices.length) {
                    Plotly.restyle(plotDiv, {'marker.size': [markerSizes], 'textfont.size': [textSizes]}, indices);
                }
            } catch (e) { console.error(e); }
        }
        // initial scale after plot settles
        setTimeout(rescaleMarkers, 250);
        plotDiv.on('plotly_relayout', rescaleMarkers);
    })();

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Mesa Gate',function(){highlight('Mesa Gate');},false,null,false)
    addButton('Munro Gap',function(){highlight('Munro Gap');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

    addButton('--- Planets ---', null, true, null);
    addButton('Phinmor IV',function(){highlight('Phinmor IV');},false,null,false)

    addButton('--- Stations ---', null, true, null);
    addButton('Argos Cantina',function(){highlight('Argos Cantina');},false,'blue',false)
    addButton('DS 111',function(){highlight('DS 111');},false,'blue',false)
    addButton('DS 133',function(){highlight('DS 133');},false,'blue',false)
    addButton('LD SM1',function(){highlight('LD SM1');},false,'blue',false)
    addButton('LD SM2',function(){highlight('LD SM2');},false,'blue',false)
    addButton('Loags Denibite',function(){highlight('Loags Denibite');},false,'blue',false)
    addButton('MM Smeltery 1224',function(){highlight('MM Smeltery 1224');},false,'blue',false)
    addButton('Master Mining Inc',function(){highlight('Master Mining Inc');},false,'blue',false)
    addButton('Mighty Mineing Sela',function(){highlight('Mighty Mineing Sela');},false,'blue',false)
    addButton('Modei Shipping',function(){highlight('Modei Shipping');},false,'blue',false)
    addButton('Phinmor Oasis',function(){highlight('Phinmor Oasis');},false,'blue',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>