
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypherion.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        /* === Description typography controls ===
           Tweak these two variables to change description sizes globally */
        :root {
            --desc-font-size: 130%;
            --hull-desc-font-size: 130%;
        }
        .desc-text { font-size: var(--desc-font-size); margin-top: 8px; }
        .hull-desc { font-size: var(--hull-desc-font-size); margin-top: 5px; color: #ccc; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Hypherion</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Green Fields": {"type": "jumpnode", "x": -61099.99999999995, "y": -150399.99999999994, "grid": "E08", "hidden": false, "label": "Green Fields", "destinations": {"Vermilion Gate": "Corus"}}, "Rock Breaker Gate": {"type": "jumpnode", "x": -55253.986625514386, "y": 201536.35116598083, "grid": "W09", "hidden": false, "label": "Rock Breaker Gate", "destinations": {"Aturin Gate": "Oberon"}}, "DS 73": {"type": "station", "x": 6092.644032921957, "y": 173473.2981824417, "grid": "U12", "hidden": false, "label": "DS 73", "hull": "starbase_command", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "Marmonto Yards": {"type": "station", "x": -130597.08147576576, "y": 2298.0116883858886, "grid": "M05", "hidden": false, "label": "Marmonto Yards", "hull": "usfp_shipyard", "facilities": ["Docking", "Refuel", "Repair"], "sides": ["USFP"], "hullName": "Ship Yard", "hullImage": "Images/Ships/TSN Mod/USFP/ShipYard256.png", "hullDescription": ""}, "Marmonto R&D": {"type": "station", "x": -126583.77105195903, "y": 3123.3597375277122, "grid": "M05", "hidden": false, "label": "Marmonto R&D", "hull": "starbase_science", "facilities": [], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "JP 61": {"type": "jumppoint", "x": -656420.3189537635, "y": 202705.34134873768, "grid": "W79", "hidden": true, "label": "**JP 61**", "destinations": {"Rhea Gate": "Tethys"}}, "WP 30": {"type": "platform", "x": -126353.33687993189, "y": 3642.3122811652465, "grid": "M05", "hidden": false, "label": "WP 30"}, "WP 24": {"type": "platform", "x": -132460.13543960222, "y": 2451.8360883438118, "grid": "M05", "hidden": false, "label": "WP 24"}, "WP 18": {"type": "platform", "x": -131866.4623863898, "y": -2694.025947585477, "grid": "L05", "hidden": false, "label": "WP 18"}, "WP 84": {"type": "platform", "x": -127362.26806175338, "y": -2641.857840976299, "grid": "L05", "hidden": false, "label": "WP 84"}, "WP 80": {"type": "platform", "x": -129472.98965516071, "y": 3625.6184870503103, "grid": "M05", "hidden": false, "label": "WP 80"}, "MY AY Queen": {"type": "station", "x": -131934.28092498172, "y": -64.75337448292022, "grid": "L05", "hidden": false, "label": "MY AY Queen", "hull": "usfp_industrial_assembly", "facilities": [], "sides": ["USFP"], "hullName": "Assembly Yard", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialAssembler256.png", "hullDescription": ""}, "MY AY Roma": {"type": "station", "x": -130962.91077991882, "y": -1786.3008925857846, "grid": "L05", "hidden": false, "label": "MY AY Roma", "hull": "usfp_industrial_assembly", "facilities": [], "sides": ["USFP"], "hullName": "Assembly Yard", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialAssembler256.png", "hullDescription": ""}, "MY Recycleing": {"type": "station", "x": -129450.03568825267, "y": 509.0957982180341, "grid": "M05", "hidden": false, "label": "MY Recycleing", "hull": "usfp_industrial_processor", "facilities": [], "sides": ["USFP"], "hullName": "Processor Unit", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialProcessor256.png", "hullDescription": ""}, "WP 90": {"type": "platform", "x": -127232.89115736262, "y": 1500.2898237924103, "grid": "M05", "hidden": false, "label": "WP 90"}, "WP 41": {"type": "platform", "x": -131119.41509974637, "y": 170.00310525837907, "grid": "M05", "hidden": false, "label": "WP 41"}, "WP 3": {"type": "platform", "x": -125850.43633221941, "y": 404.7595849996787, "grid": "M05", "hidden": false, "label": "WP 3"}, "WP 53": {"type": "platform", "x": -133649.56827029152, "y": 149.67841092344335, "grid": "M05", "hidden": false, "label": "WP 53"}, "Dilko Refinery": {"type": "station", "x": -5046.8882152956485, "y": 246458.13912563608, "grid": "Y11", "hidden": false, "label": "Dilko Refinery", "hull": "usfp_industrial_refinary", "facilities": ["Refuel", "Docking"], "sides": ["USFP"], "hullName": "Refinary Unit", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialRefinary256.png", "hullDescription": ""}, "Dilko M989": {"type": "station", "x": -8857.201646090392, "y": 242917.74262688617, "grid": "Y11", "hidden": false, "label": "Dilko M989", "hull": "starbase_industry", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "Nixi Foundry": {"type": "station", "x": -88892.41857020152, "y": 241736.44131310456, "grid": "Y07", "hidden": false, "label": "Nixi Foundry", "hull": "starbase_industry", "facilities": ["Docking", "Refuel", "Repair"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "DS 72": {"type": "station", "x": -87305.46256039292, "y": 242198.2007173442, "grid": "Y07", "hidden": false, "label": "DS 72", "hull": "starbase_industry", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "DS 70": {"type": "station", "x": -89784.49098646104, "y": 240094.78265886215, "grid": "Y07", "hidden": false, "label": "DS 70", "hull": "starbase_civil", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 61": {"type": "station", "x": 43277.30090398176, "y": 14492.66028797798, "grid": "M14", "hidden": false, "label": "DS 61", "hull": "starbase_civil", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 25": {"type": "station", "x": 48526.71505578791, "y": -1693.1821903028085, "grid": "L14", "hidden": false, "label": "DS 25", "hull": "starbase_civil", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 31": {"type": "station", "x": 61085.389181302315, "y": 9749.165346276985, "grid": "M15", "hidden": false, "label": "DS 31", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Hypherion Armory": {"type": "station", "x": 200008.73594627704, "y": -11141.653269406615, "grid": "L22", "hidden": false, "label": "Hypherion Armory", "hull": "starbase_command", "facilities": ["Docking", "Refuel", "Repair"], "sides": ["USFP"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "NanoGel Reasearch": {"type": "station", "x": 200304.51783928118, "y": 1104.3601050789991, "grid": "M22", "hidden": false, "label": "NanoGel Reasearch", "hull": "starbase_science", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "WP 63": {"type": "platform", "x": 194526.63335706195, "y": -11585.85784463888, "grid": "L21", "hidden": false, "label": "WP 63"}, "WP 11": {"type": "platform", "x": 194310.28178533236, "y": -4770.783335157056, "grid": "L21", "hidden": false, "label": "WP 11"}, "WP 1": {"type": "platform", "x": 204695.1572283523, "y": -3797.2012623739383, "grid": "L22", "hidden": false, "label": "WP 1"}, "WP 2": {"type": "platform", "x": 205073.77247887905, "y": -11585.85784463888, "grid": "L22", "hidden": false, "label": "WP 2"}, "WP 22": {"type": "platform", "x": 199989.5105432339, "y": -3202.2344401175887, "grid": "L21", "hidden": false, "label": "WP 22"}, "WP 26": {"type": "platform", "x": 199989.5105432339, "y": -12667.615703286789, "grid": "L21", "hidden": false, "label": "WP 26"}, "Port Ash": {"type": "station", "x": 614214.1344925419, "y": -116188.37177349221, "grid": "G42", "hidden": true, "label": "**Port Ash**", "hull": "pirate_military_base", "facilities": [], "sides": ["Pirate"], "hullName": "Pirate Base", "hullImage": "Images/Ships/TSN Mod/Pirate/PirateBaseAst256.png", "hullDescription": ""}, "WP 7": {"type": "platform", "x": 612156.2260450503, "y": -117308.68054841767, "grid": "G42", "hidden": true, "label": "**WP 7**"}, "WP 6": {"type": "platform", "x": 616331.3036098602, "y": -114776.14851221119, "grid": "G42", "hidden": true, "label": "**WP 6**"}, "WP 87": {"type": "platform", "x": 613064.9026463145, "y": -114128.31244399284, "grid": "G42", "hidden": true, "label": "**WP 87**"}, "WP 16": {"type": "platform", "x": 615271.6886779562, "y": -117850.87967862621, "grid": "G42", "hidden": true, "label": "**WP 16**"}, "WP 43": {"type": "platform", "x": 612917.2933364514, "y": -115877.36298790007, "grid": "G42", "hidden": true, "label": "**WP 43**"}, "WP 10": {"type": "platform", "x": 615482.225244736, "y": -116181.67694312027, "grid": "G42", "hidden": true, "label": "**WP 10**"}, "Brigadooin": {"type": "station", "x": 531916.7758428085, "y": -128394.52316407557, "grid": "F38", "hidden": true, "label": "**Brigadooin**", "description": "Abandoned Mining Operation, Facility shuttered 19 Months ago due to Fiscal unviability.", "hull": "starbase_industry", "facilities": [], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "JP 30": {"type": "jumppoint", "x": 691422.424533228, "y": -185026.4408650554, "grid": "C46", "hidden": true, "label": "**JP 30**", "destinations": {"Unknown": "Unknown"}}, "Y 32": {"type": "station", "x": -128127.35604727901, "y": -2039.1369964853461, "grid": "L05", "hidden": false, "label": "Y 32", "hull": "starbase_industry", "facilities": [], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "Direct Warehousing": {"type": "station", "x": 53138.81419454616, "y": 15972.27120568219, "grid": "M14", "hidden": false, "label": "Direct Warehousing", "hull": "starbase_industry", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "SR 23": {"type": "sensor_relay", "x": -54074.39557613155, "y": 191066.52949245548, "grid": "V09", "hidden": false, "label": "SR 23"}, "SR 97": {"type": "sensor_relay", "x": -56623.90689300398, "y": 127578.98233882034, "grid": "S09", "hidden": false, "label": "SR 97"}, "SR 86": {"type": "sensor_relay", "x": -57164.030349794106, "y": 86529.59962277095, "grid": "Q09", "hidden": false, "label": "SR 86"}, "SR 43": {"type": "sensor_relay", "x": -57704.153806584225, "y": 45480.21690672156, "grid": "O09", "hidden": false, "label": "SR 43"}, "SR 67": {"type": "sensor_relay", "x": -58244.27726337435, "y": 4430.834190672176, "grid": "M09", "hidden": false, "label": "SR 67"}, "SR 65": {"type": "sensor_relay", "x": -58784.40072016447, "y": -36618.548525377206, "grid": "K09", "hidden": false, "label": "SR 65"}, "SR 40": {"type": "sensor_relay", "x": -59324.5241769546, "y": -77667.93124142662, "grid": "I09", "hidden": false, "label": "SR 40"}, "SR 33": {"type": "sensor_relay", "x": -59864.64763374472, "y": -118717.313957476, "grid": "G09", "hidden": false, "label": "SR 33"}, "SR 27": {"type": "sensor_relay", "x": -10371.12054183802, "y": 206382.3516803841, "grid": "W11", "hidden": false, "label": "SR 27"}, "SR 90": {"type": "sensor_relay", "x": -27314.079458195007, "y": 241564.76839144545, "grid": "Y10", "hidden": false, "label": "SR 90"}, "SR 15": {"type": "sensor_relay", "x": -65384.56256987216, "y": 250254.10772856616, "grid": "Y08", "hidden": false, "label": "SR 15"}, "SR 37": {"type": "sensor_relay", "x": -95914.71959744688, "y": 225907.11994067422, "grid": "X07", "hidden": false, "label": "SR 37"}, "SR 60": {"type": "sensor_relay", "x": -95914.71959744688, "y": 186857.583420094, "grid": "V07", "hidden": false, "label": "SR 60"}, "SR 72": {"type": "sensor_relay", "x": -65384.56256987218, "y": 162510.59563220205, "grid": "U08", "hidden": false, "label": "SR 72"}, "SR 11": {"type": "sensor_relay", "x": -27314.079458195018, "y": 171199.93496932276, "grid": "U10", "hidden": false, "label": "SR 11"}, "SR 58": {"type": "sensor_relay", "x": -16399.284122084937, "y": -154972.56515775042, "grid": "E11", "hidden": false, "label": "SR 58"}, "SR 46": {"type": "sensor_relay", "x": -33342.24303844193, "y": -119790.14844668907, "grid": "G10", "hidden": false, "label": "SR 46"}, "SR 50": {"type": "sensor_relay", "x": -71412.72615011908, "y": -111100.80910956836, "grid": "G08", "hidden": false, "label": "SR 50"}, "SR 71": {"type": "sensor_relay", "x": -101942.88317769379, "y": -135447.7968974603, "grid": "F06", "hidden": false, "label": "SR 71"}, "SR 41": {"type": "sensor_relay", "x": -101942.88317769379, "y": -174497.33341804054, "grid": "D06", "hidden": false, "label": "SR 41"}, "SR 74": {"type": "sensor_relay", "x": -71412.7261501191, "y": -198844.32120593247, "grid": "C08", "hidden": false, "label": "SR 74"}, "SR 42": {"type": "sensor_relay", "x": -33342.243038441935, "y": -190154.98186881177, "grid": "C10", "hidden": false, "label": "SR 42"}, "SR 34": {"type": "sensor_relay", "x": -112294.39035752794, "y": 1435.4768739489184, "grid": "M06", "hidden": false, "label": "SR 34"}, "SR 18": {"type": "sensor_relay", "x": -67294.39035752794, "y": 1435.4768739489184, "grid": "M08", "hidden": false, "label": "SR 18"}, "SR 56": {"type": "sensor_relay", "x": -84237.34927388493, "y": 36617.89358501026, "grid": "N07", "hidden": false, "label": "SR 56"}, "SR 81": {"type": "sensor_relay", "x": -122307.83238556208, "y": 45307.23292213098, "grid": "O05", "hidden": false, "label": "SR 81"}, "SR 77": {"type": "sensor_relay", "x": -152837.9894131368, "y": 20960.245134239038, "grid": "N04", "hidden": false, "label": "SR 77"}, "SR 80": {"type": "sensor_relay", "x": -152837.9894131368, "y": -18089.291386341192, "grid": "L04", "hidden": false, "label": "SR 80"}, "SR 28": {"type": "sensor_relay", "x": -122307.8323855621, "y": -42436.27917423315, "grid": "J05", "hidden": false, "label": "SR 28"}, "SR 31": {"type": "sensor_relay", "x": -84237.34927388493, "y": -33746.93983711243, "grid": "K07", "hidden": false, "label": "SR 31"}, "SR 85": {"type": "sensor_relay", "x": -59248.42147674991, "y": 275690.3707742682, "grid": "Z09", "hidden": false, "label": "SR 85"}, "SR 61": {"type": "sensor_relay", "x": -97318.90458842706, "y": 284379.71011138894, "grid": "A07", "hidden": false, "label": "SR 61"}, "SR 21": {"type": "sensor_relay", "x": -127849.06161600177, "y": 260032.72232349697, "grid": "Z05", "hidden": false, "label": "SR 21"}, "SR 64": {"type": "sensor_relay", "x": -127849.06161600177, "y": 220983.18580291673, "grid": "X05", "hidden": false, "label": "SR 64"}, "SR 32": {"type": "sensor_relay", "x": -97318.90458842707, "y": 196636.1980150248, "grid": "V07", "hidden": false, "label": "SR 32"}, "Nixie Drop Off": {"type": "sensor_relay", "x": -87305.46256039292, "y": 240507.95406320685, "grid": "Y07", "hidden": false, "label": "Nixie Drop Off"}, "SR 98": {"type": "sensor_relay", "x": 50161.44942364329, "y": 8698.774542664776, "grid": "M14", "hidden": false, "label": "SR 98"}, "SR 68": {"type": "sensor_relay", "x": 27476.264238458098, "y": -23708.63286474264, "grid": "K13", "hidden": false, "label": "SR 68"}, "SR 96": {"type": "sensor_relay", "x": 4791.079053272908, "y": -56116.04027215006, "grid": "J12", "hidden": false, "label": "SR 96"}, "SR 59": {"type": "sensor_relay", "x": -17894.106131912275, "y": -88523.44767955747, "grid": "H11", "hidden": false, "label": "SR 59"}, "SR 14": {"type": "sensor_relay", "x": -36378.86693438141, "y": 157781.9578417046, "grid": "T10", "hidden": false, "label": "SR 14"}, "SR 48": {"type": "sensor_relay", "x": -13873.722901459594, "y": 119804.52728614904, "grid": "R11", "hidden": false, "label": "SR 48"}, "SR 76": {"type": "sensor_relay", "x": 8631.421131462223, "y": 81827.09673059348, "grid": "Q12", "hidden": false, "label": "SR 76"}, "SR 63": {"type": "sensor_relay", "x": 31136.56516438404, "y": 43849.66617503791, "grid": "O13", "hidden": false, "label": "SR 63"}, "SR 75": {"type": "sensor_relay", "x": 199865.82277620363, "y": -7277.019241878914, "grid": "L21", "hidden": false, "label": "SR 75"}, "SR 99": {"type": "sensor_relay", "x": 180071.80363216365, "y": -7067.905928333112, "grid": "L21", "hidden": false, "label": "SR 99"}, "SR 10": {"type": "sensor_relay", "x": 220662.23612377193, "y": -4231.667506230879, "grid": "L23", "hidden": false, "label": "SR 10"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p class="hull-desc">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else if (obj.type === 'planet') {
            if (obj['class']) {
                infoHtml += '<b>Class:</b> ' + obj['class'] + '<br>';
            }
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p class="desc-text">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [-72538.014894875, -77226.58656840038, -97037.17371966544, -92348.60204614006, -72538.014894875], "y": [178648.81688917286, 212473.51253389168, 209727.4905525282, 175902.79490780938, 178648.81688917286], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-87436.95181233567, -97818.78908942759, -75775.17524527744, -65393.337968185515, -87436.95181233567], "y": [235604.98236991267, 211492.32804892503, 202001.32764380483, 226113.98196479247, 235604.98236991267], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-57214.42973276031, -70275.4508232953, -99299.73779124512, -86238.71670071014, -57214.42973276031], "y": [161575.42236417942, 189706.8524053317, 176231.2905987836, 148099.86055763133, 161575.42236417942], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-58380.6939369079, -85172.53207133862, -72346.32938270798, -45554.49124827724, -58380.6939369079], "y": [253890.44894279723, 242169.01975898378, 212851.98504211372, 224573.41422592718, 253890.44894279723], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-24851.29943157424, -57671.30114625189, -55641.027385983994, -22821.025671306343, -24851.29943157424], "y": [249180.27300967486, 245831.293242871, 225934.6103922457, 229283.59015904955, 249180.27300967486], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [4335.506952509235, -26140.20892540573, -35597.831198051, -5122.115320136038, 4335.506952509235], "y": [227744.48925164636, 244489.38808566556, 227276.51554945114, 210531.61671543194, 227744.48925164636], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [8556.092177148257, 5207.1124103444145, -14701.068171661207, -11352.088404857364, 8556.092177148257], "y": [187610.07331198445, 222439.46288674444, 220525.2147538593, 185695.8251790993, 187610.07331198445], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-2168.4638370583452, 6873.781533312027, -12348.96157446421, -21391.206944834583, -2168.4638370583452], "y": [159109.78586528942, 190590.1956732455, 196111.62188505355, 164631.21207709747, 159109.78586528942], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [51886.01684551548, -1631.322832125179, -29296.1034367362, 24221.236240904458, 51886.01684551548], "y": [82543.44706967732, 174600.52440163892, 158517.61688779874, 66460.53955583714, 82543.44706967732], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-105605.84942529685, -118331.97253915147, -80823.33438814603, -68097.21127429142, -105605.84942529685], "y": [165221.3919417747, 86855.26539856482, 80764.11903216223, 159130.24557537213, 165221.3919417747], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-162158.2821226745, -83792.15557946463, -129428.86636840901, -207794.9929116189, -162158.2821226745], "y": [-9958.430440694847, 69747.28800923658, 114616.99525550964, 34911.27680557821, -9958.430440694847], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-121876.73990087822, -160276.73990087822, -189910.81153945072, -151510.81153945072, -121876.73990087822], "y": [-241368.1719359315, 2231.8280640684743, -2439.552686839502, -246039.55268683948, -241368.1719359315], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [125838.68395445835, 182513.60083383147, 178248.68148458586, 121573.76460521271, 125838.68395445835], "y": [-156273.84776358074, -143903.61697877373, -124363.64607438317, -136733.87685919018, -156273.84776358074], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [2372.7061742549586, -148827.29382574503, -134160.2576145839, 17039.7423854161, 2372.7061742549586], "y": [-21080.77781867617, -53480.77781867617, -121926.94680409483, -89526.94680409483, -21080.77781867617], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [46448.91792004885, -8751.082079951142, -22236.469360377792, 32963.53063962221, 46448.91792004885], "y": [-101919.00737210424, -51519.00737210424, -66288.71725066676, -116688.71725066676, -101919.00737210424], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-186028.0786863638, -140428.0786863638, -125759.47275396516, -171359.47275396515, -186028.0786863638], "y": [-11701.508962984857, -60901.50896298486, -47306.21565978614, 1893.7843402138587, -11701.508962984857], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [280587.44947723765, 175820.782810571, 328941.4995078463, 433708.16617451294, 280587.44947723765], "y": [192716.66410949855, -152927.78033494594, -199339.48271821096, 146304.96172623354, 192716.66410949855], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [152636.20816641222, 107036.20816641222, 112126.07415200511, 157726.0741520051, 152636.20816641222], "y": [201937.113846048, 189937.113846048, 170595.62310079508, 182595.62310079508, 201937.113846048], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-2756.7170030022785, -44756.717003002275, -38481.00067858039, 3518.9993214196106, -2756.7170030022785], "y": [-299644.34071552375, -308044.34071552375, -339422.92233763315, -331022.92233763315, -299644.34071552375], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [555220.2000007855, 486237.9777785632, 471520.0183514981, 540502.2405737203, 555220.2000007855], "y": [-113845.82096079901, -38872.48762746564, -52414.336478463214, -127387.66981179659, -113845.82096079901], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [540364.0484144632, 552864.0484144632, 533136.1699378204, 520636.16993782035, 540364.0484144632], "y": [-187538.51303712913, -112538.51303712915, -109250.53329102199, -184250.533291022, -187538.51303712913], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [498682.2880991184, 549376.7325435629, 535234.5969198319, 484540.15247538744, 498682.2880991184], "y": [-151993.36875371882, -101298.92430927439, -87156.78868554343, -137851.23312998787, -151993.36875371882], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [550769.2113271963, 500074.76688275184, 483147.673691754, 533842.1181361985, 550769.2113271963], "y": [-183346.10351537558, -102790.54795982, -113442.94281277557, -193998.49836833111, -183346.10351537558], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [693739.4405866144, 560406.1072532809, 549205.2222101139, 682538.5555434474, 693739.4405866144], "y": [-63656.46960051829, -51156.46960051829, -170632.57672763287, -183132.57672763287, -63656.46960051829], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-119113.38647253448, -119198.93785879637, -119454.1282096438, -119874.59114742161, -120453.1324346901, -121179.85306962213, -122042.318660669, -123025.77218244727, -124113.38647253448, -125286.55214888358, -126525.19602150927, -127808.12455033396, -129113.38647253448, -130418.64839473499, -131701.57692355968, -132940.22079618537, -134113.38647253448, -135201.00076262167, -136184.45428439995, -137046.91987544682, -137773.64051037887, -138352.18179764735, -138772.64473542516, -139027.8350862726, -139113.38647253448, -139027.8350862726, -138772.64473542516, -138352.18179764735, -137773.64051037887, -137046.91987544682, -136184.45428439995, -135201.0007626217, -134113.38647253448, -132940.22079618537, -131701.57692355968, -130418.64839473499, -129113.38647253448, -127808.12455033396, -126525.19602150927, -125286.55214888358, -124113.38647253448, -123025.77218244728, -122042.318660669, -121179.85306962213, -120453.1324346901, -119874.59114742161, -119454.1282096438, -119198.93785879637, -119113.38647253448], "y": [-12652.440554347386, -11347.17863214687, -10064.250103322178, -8825.606230696489, -7652.440554347387, -6564.826264260179, -5581.37274248191, -4718.907151435034, -3992.1865165029994, -3413.6452292345184, -2993.182291456702, -2737.9919406092813, -2652.440554347386, -2737.9919406092813, -2993.182291456702, -3413.6452292345166, -3992.1865165029994, -4718.907151435034, -5581.37274248191, -6564.826264260177, -7652.440554347387, -8825.606230696487, -10064.250103322176, -11347.178632146866, -12652.440554347384, -13957.702476547904, -15240.631005372594, -16479.274877998283, -17652.440554347384, -18740.05484443459, -19723.508366212856, -20585.973957259735, -21312.694592191772, -21891.235879460255, -22311.69881723807, -22566.88916808549, -22652.440554347384, -22566.88916808549, -22311.69881723807, -21891.235879460255, -21312.694592191772, -20585.973957259743, -19723.508366212864, -18740.054844434595, -17652.44055434739, -16479.27487799828, -15240.631005372601, -13957.702476547904, -12652.440554347386], "fill": "toself", "fillcolor": "rgba(64,64,64,0.4)", "line": {"shape": "spline", "color": "rgba(64,64,64,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-61099.99999999995], "y": [-150399.99999999994], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Green Fields [E08]"], "hoverinfo": "text", "text": ["Green Fields"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-55253.986625514386], "y": [201536.35116598083], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Rock Breaker Gate [W09]"], "hoverinfo": "text", "text": ["Rock Breaker Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [6092.644032921957], "y": [173473.2981824417], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 73 [U12]"], "hoverinfo": "text", "text": ["DS 73"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-130597.08147576576], "y": [2298.0116883858886], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Marmonto Yards [M05]"], "hoverinfo": "text", "text": ["Marmonto Yards"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-126583.77105195903], "y": [3123.3597375277122], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Marmonto R&D [M05]"], "hoverinfo": "text", "text": ["Marmonto R&D"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-656420.3189537635], "y": [202705.34134873768], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["JP 61 [W79]"], "hoverinfo": "text", "text": ["**JP 61**"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "gmOnly": true, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-126353.33687993189], "y": [3642.3122811652465], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 30 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-132460.13543960222], "y": [2451.8360883438118], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 24 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-131866.4623863898], "y": [-2694.025947585477], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 18 [L05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-127362.26806175338], "y": [-2641.857840976299], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 84 [L05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-129472.98965516071], "y": [3625.6184870503103], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 80 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-131934.28092498172], "y": [-64.75337448292022], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["MY AY Queen [L05]"], "hoverinfo": "text", "text": ["MY AY Queen"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-130962.91077991882], "y": [-1786.3008925857846], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["MY AY Roma [L05]"], "hoverinfo": "text", "text": ["MY AY Roma"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-129450.03568825267], "y": [509.0957982180341], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["MY Recycleing [M05]"], "hoverinfo": "text", "text": ["MY Recycleing"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-127232.89115736262], "y": [1500.2898237924103], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 90 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-131119.41509974637], "y": [170.00310525837907], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 41 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-125850.43633221941], "y": [404.7595849996787], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 3 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-133649.56827029152], "y": [149.67841092344335], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 53 [M05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-5046.8882152956485], "y": [246458.13912563608], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Dilko Refinery [Y11]"], "hoverinfo": "text", "text": ["Dilko Refinery"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-8857.201646090392], "y": [242917.74262688617], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Dilko M989 [Y11]"], "hoverinfo": "text", "text": ["Dilko M989"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-88892.41857020152], "y": [241736.44131310456], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Nixi Foundry [Y07]"], "hoverinfo": "text", "text": ["Nixi Foundry"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-87305.46256039292], "y": [242198.2007173442], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 72 [Y07]"], "hoverinfo": "text", "text": ["DS 72"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-89784.49098646104], "y": [240094.78265886215], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 70 [Y07]"], "hoverinfo": "text", "text": ["DS 70"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [43277.30090398176], "y": [14492.66028797798], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 61 [M14]"], "hoverinfo": "text", "text": ["DS 61"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [48526.71505578791], "y": [-1693.1821903028085], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 25 [L14]"], "hoverinfo": "text", "text": ["DS 25"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [61085.389181302315], "y": [9749.165346276985], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 31 [M15]"], "hoverinfo": "text", "text": ["DS 31"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [200008.73594627704], "y": [-11141.653269406615], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Hypherion Armory [L22]"], "hoverinfo": "text", "text": ["Hypherion Armory"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [200304.51783928118], "y": [1104.3601050789991], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["NanoGel Reasearch [M22]"], "hoverinfo": "text", "text": ["NanoGel Reasearch"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [194526.63335706195], "y": [-11585.85784463888], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 63 [L21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [194310.28178533236], "y": [-4770.783335157056], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 11 [L21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [204695.1572283523], "y": [-3797.2012623739383], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 1 [L22]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [205073.77247887905], "y": [-11585.85784463888], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 2 [L22]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [199989.5105432339], "y": [-3202.2344401175887], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 22 [L21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [199989.5105432339], "y": [-12667.615703286789], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 26 [L21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [614214.1344925419], "y": [-116188.37177349221], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Port Ash [G42]"], "hoverinfo": "text", "text": ["**Port Ash**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [612156.2260450503], "y": [-117308.68054841767], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 7 [G42]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [616331.3036098602], "y": [-114776.14851221119], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 6 [G42]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [613064.9026463145], "y": [-114128.31244399284], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 87 [G42]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [615271.6886779562], "y": [-117850.87967862621], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 16 [G42]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [612917.2933364514], "y": [-115877.36298790007], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 43 [G42]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [615482.225244736], "y": [-116181.67694312027], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 10 [G42]"], "hoverinfo": "text", "gmOnly": true, "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [531916.7758428085], "y": [-128394.52316407557], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Brigadooin [F38]"], "hoverinfo": "text", "text": ["**Brigadooin**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [691422.424533228], "y": [-185026.4408650554], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["JP 30 [C46]"], "hoverinfo": "text", "text": ["**JP 30**"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "gmOnly": true, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-128127.35604727901], "y": [-2039.1369964853461], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Y 32 [L05]"], "hoverinfo": "text", "text": ["Y 32"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [53138.81419454616], "y": [15972.27120568219], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Direct Warehousing [M14]"], "hoverinfo": "text", "text": ["Direct Warehousing"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-54074.39557613155], "y": [191066.52949245548], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 23 [V09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-56623.90689300398], "y": [127578.98233882034], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 97 [S09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-57164.030349794106], "y": [86529.59962277095], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 86 [Q09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-57704.153806584225], "y": [45480.21690672156], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 43 [O09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-58244.27726337435], "y": [4430.834190672176], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 67 [M09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-58784.40072016447], "y": [-36618.548525377206], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 65 [K09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-59324.5241769546], "y": [-77667.93124142662], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 40 [I09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-59864.64763374472], "y": [-118717.313957476], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 33 [G09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-10371.12054183802], "y": [206382.3516803841], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 27 [W11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-27314.079458195007], "y": [241564.76839144545], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 90 [Y10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-65384.56256987216], "y": [250254.10772856616], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 15 [Y08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-95914.71959744688], "y": [225907.11994067422], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 37 [X07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-95914.71959744688], "y": [186857.583420094], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 60 [V07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-65384.56256987218], "y": [162510.59563220205], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 72 [U08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-27314.079458195018], "y": [171199.93496932276], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 11 [U10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-16399.284122084937], "y": [-154972.56515775042], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 58 [E11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-33342.24303844193], "y": [-119790.14844668907], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 46 [G10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-71412.72615011908], "y": [-111100.80910956836], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 50 [G08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-101942.88317769379], "y": [-135447.7968974603], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 71 [F06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-101942.88317769379], "y": [-174497.33341804054], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 41 [D06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-71412.7261501191], "y": [-198844.32120593247], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 74 [C08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-33342.243038441935], "y": [-190154.98186881177], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 42 [C10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-112294.39035752794], "y": [1435.4768739489184], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 34 [M06]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-67294.39035752794], "y": [1435.4768739489184], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 18 [M08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-84237.34927388493], "y": [36617.89358501026], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 56 [N07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-122307.83238556208], "y": [45307.23292213098], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 81 [O05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-152837.9894131368], "y": [20960.245134239038], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 77 [N04]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-152837.9894131368], "y": [-18089.291386341192], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 80 [L04]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-122307.8323855621], "y": [-42436.27917423315], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 28 [J05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-84237.34927388493], "y": [-33746.93983711243], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 31 [K07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-59248.42147674991], "y": [275690.3707742682], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 85 [Z09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-97318.90458842706], "y": [284379.71011138894], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 61 [A07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-127849.06161600177], "y": [260032.72232349697], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 21 [Z05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-127849.06161600177], "y": [220983.18580291673], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 64 [X05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-97318.90458842707], "y": [196636.1980150248], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 32 [V07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-87305.46256039292], "y": [240507.95406320685], "mode": "markers+text", "marker": {"symbol": "circle", "size": 6, "color": "#FF13F0"}, "hovertext": ["Nixie Drop Off [Y07]"], "hoverinfo": "text", "text": ["Nixie Drop Off"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 6, "base_text_size": 14}}, {"type": "scatter", "x": [50161.44942364329], "y": [8698.774542664776], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 98 [M14]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [27476.264238458098], "y": [-23708.63286474264], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 68 [K13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [4791.079053272908], "y": [-56116.04027215006], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 96 [J12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-17894.106131912275], "y": [-88523.44767955747], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 59 [H11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-36378.86693438141], "y": [157781.9578417046], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 14 [T10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-13873.722901459594], "y": [119804.52728614904], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 48 [R11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [8631.421131462223], "y": [81827.09673059348], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 76 [Q12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [31136.56516438404], "y": [43849.66617503791], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 63 [O13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [199865.82277620363], "y": [-7277.019241878914], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 75 [L21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [180071.80363216365], "y": [-7067.905928333112], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 99 [L21]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [220662.23612377193], "y": [-4231.667506230879], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 10 [L23]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}], "layout": {"title": "Hypherion", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Hypherion';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Use Plotly's built-in nearest-point selection for accurate clicks
    plotDiv.on('plotly_click', function(ev) {
        if (!ev || !ev.points || !ev.points.length) return;
        var p = ev.points[0];
        var picked = null;
        // Prefer original name from hovertext: "Name [Grid]"
        if (p.hovertext && typeof p.hovertext === 'string') {
            picked = p.hovertext.split(' [')[0];
        } else if (p.text && typeof p.text === 'string') {
            // Fallback to text label (strip any ** used for GM marking)
            picked = p.text.replace(/\*/g, '');
        }
        if (picked && objData[picked]) {
            highlight(picked);
        }
    });

    // ——— Auto-scale markers based on current zoom/span (optimized: planets & blackholes only) ———
    (function() {
        var refSpan = null;
        var planetIdx = [];
        var bhIdx = [];
        function rescaleMarkers() {
            try {
                var full = plotDiv._fullLayout || {};
                var xaxis = full.xaxis || (fig.layout && fig.layout.xaxis);
                if (!xaxis || !xaxis.range) return;
                var curr = Math.abs(xaxis.range[1] - xaxis.range[0]);
                if (!curr) return;
                if (!refSpan) refSpan = curr;
                var scale = refSpan / curr;
                var indices = [];
                var markerSizes = [];
                var textSizes = [];
                function pushForIndex(i) {
                    var t = fig.data[i];
                    if (!t || !t.meta || !t.meta.base_marker_size) return;
                    var base = t.meta.base_marker_size;
                    var baseText = t.meta.base_text_size || (t.textfont && t.textfont.size) || 12;
                    var newMarker = Math.max(2, Math.round(base * scale));
                    var newText = Math.max(8, Math.round(baseText * Math.sqrt(scale)));
                    indices.push(i);
                    markerSizes.push(newMarker);
                    textSizes.push(newText);
                }
                planetIdx.forEach(pushForIndex);
                bhIdx.forEach(pushForIndex);
                if (indices.length) {
                    Plotly.restyle(plotDiv, {'marker.size': [markerSizes], 'textfont.size': [textSizes]}, indices);
                }
            } catch (e) { console.error(e); }
        }
        // initial scale after plot settles
        setTimeout(rescaleMarkers, 250);
        plotDiv.on('plotly_relayout', rescaleMarkers);
    })();

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Green Fields',function(){highlight('Green Fields');},false,null,false)
    addButton('JP 30',function(){highlight('JP 30');},false,null,true)
    addButton('JP 61',function(){highlight('JP 61');},false,null,true)
    addButton('Rock Breaker Gate',function(){highlight('Rock Breaker Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  addButton('Nixie Drop Off',function(){highlight('Nixie Drop Off');},false,null,false)

    addButton('--- Planets ---', null, true, null);
    

    addButton('--- Stations ---', null, true, null);
    addButton('Brigadooin',function(){highlight('Brigadooin');},false,'blue',true)
    addButton('DS 25',function(){highlight('DS 25');},false,'blue',false)
    addButton('DS 31',function(){highlight('DS 31');},false,'blue',false)
    addButton('DS 61',function(){highlight('DS 61');},false,'blue',false)
    addButton('DS 70',function(){highlight('DS 70');},false,'blue',false)
    addButton('DS 72',function(){highlight('DS 72');},false,'blue',false)
    addButton('DS 73',function(){highlight('DS 73');},false,'blue',false)
    addButton('Dilko M989',function(){highlight('Dilko M989');},false,'blue',false)
    addButton('Dilko Refinery',function(){highlight('Dilko Refinery');},false,'blue',false)
    addButton('Direct Warehousing',function(){highlight('Direct Warehousing');},false,'blue',false)
    addButton('Hypherion Armory',function(){highlight('Hypherion Armory');},false,'blue',false)
    addButton('MY AY Queen',function(){highlight('MY AY Queen');},false,'blue',false)
    addButton('MY AY Roma',function(){highlight('MY AY Roma');},false,'blue',false)
    addButton('MY Recycleing',function(){highlight('MY Recycleing');},false,'blue',false)
    addButton('Marmonto R&D',function(){highlight('Marmonto R&D');},false,'blue',false)
    addButton('Marmonto Yards',function(){highlight('Marmonto Yards');},false,'blue',false)
    addButton('NanoGel Reasearch',function(){highlight('NanoGel Reasearch');},false,'blue',false)
    addButton('Nixi Foundry',function(){highlight('Nixi Foundry');},false,'blue',false)
    addButton('Port Ash',function(){highlight('Port Ash');},false,'red',true)
    addButton('Y 32',function(){highlight('Y 32');},false,'blue',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>