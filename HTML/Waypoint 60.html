
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waypoint 60.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        /* === Description typography controls ===
           Tweak these two variables to change description sizes globally */
        :root {
            --desc-font-size: 130%;
            --hull-desc-font-size: 130%;
        }
        .desc-text { font-size: var(--desc-font-size); margin-top: 8px; }
        .hull-desc { font-size: var(--hull-desc-font-size); margin-top: 5px; color: #ccc; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Waypoint 60</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Rose Gate": {"type": "jumpnode", "x": -114361.09567901239, "y": -102522.76234567909, "grid": "G06", "hidden": false, "label": "Rose Gate", "destinations": {"Egan Gate": "Danae", "Zephhyr Gate": "Brightfall", "Hydrogen Gate": "AlMare"}}, "Delphinium Gate": {"type": "jumpnode", "x": 116472.23765432095, "y": 130810.57098765427, "grid": "S17", "hidden": false, "label": "Delphinium Gate", "destinations": {"Waypoint 60 Gate": "Atlantis", "Waypoint 60": "Krisenda"}}, "DS 82": {"type": "station", "x": -13791.377425841114, "y": -6093.905340290381, "grid": "L11", "hidden": false, "label": "DS 82", "hull": "starbase_civil", "facilities": ["Docking", "Refuel", "Repair"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Happy Eater Trading": {"type": "station", "x": -24.0329218107654, "y": -11068.287037037153, "grid": "L11", "hidden": false, "label": "Happy Eater Trading", "description": "The Happy Eater Trading Co (HET) is an start up company takeing advantatge of Waypoint 60's growing importance as a net work hub. Bar, Crew rest facilitys and flea market with plenty of storage for transshiping.g", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "HET S07": {"type": "platform", "x": -1756.45808790694, "y": -13479.963052217732, "grid": "L11", "hidden": false, "label": "HET S07"}, "HET S08": {"type": "platform", "x": 2729.8081034776696, "y": -11797.613230448507, "grid": "L12", "hidden": false, "label": "HET S08"}, "Happy Eater": {"type": "station", "x": -146968.63095030186, "y": -135919.7937101231, "grid": "F04", "hidden": false, "label": "Happy Eater", "description": "Rest Stop for the weary, has some luxuray facilites and a number of resturants for all price points.", "hull": "starbase_civil", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "IMO 31": {"type": "station", "x": -165057.25623396458, "y": -145448.623100624, "grid": "E03", "hidden": false, "label": "IMO 31", "hull": "starbase_industry", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "IMO 224": {"type": "station", "x": 157726.84251572317, "y": 158291.99008119857, "grid": "T19", "hidden": false, "label": "IMO 224", "description": "Inderpendent Mining Operation Claim 224. Big6 Mining Co, Monk Industries, Hamilton Ore Recovery.", "hull": "starbase_industry", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Industrial Starbase", "hullImage": "Images/Ships/industry_station256.png", "hullDescription": ""}, "WP 74": {"type": "platform", "x": -162488.36521231313, "y": -146207.80693986674, "grid": "E03", "hidden": false, "label": "WP 74"}, "Vita Refinery": {"type": "station", "x": -161196.32054919435, "y": -148468.88510032458, "grid": "E03", "hidden": false, "label": "Vita Refinery", "hull": "usfp_industrial_refinary", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Refinary Unit", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialRefinary256.png", "hullDescription": ""}, "JP 31": {"type": "jumppoint", "x": 197728.23765432087, "y": -66530.76234567916, "grid": "I21", "hidden": true, "label": "**JP 31**", "destinations": {"JP 84": "Danae"}}, "WP 53": {"type": "platform", "x": -21289.56995408448, "y": -492.718536792323, "grid": "L10", "hidden": false, "label": "WP 53"}, "SR 23": {"type": "sensor_relay", "x": -59136.98812976935, "y": -45708.83592741351, "grid": "J09", "hidden": false, "label": "SR 23"}, "SR 61": {"type": "sensor_relay", "x": -29102.265907547117, "y": -15326.891482969062, "grid": "L10", "hidden": false, "label": "SR 61"}, "SR 50": {"type": "sensor_relay", "x": 932.4563146751025, "y": 15055.05296147539, "grid": "M12", "hidden": false, "label": "SR 50"}, "SR 70": {"type": "sensor_relay", "x": 30967.17853689732, "y": 45436.99740591983, "grid": "O13", "hidden": false, "label": "SR 70"}, "SR 17": {"type": "sensor_relay", "x": 61001.90075911957, "y": 75818.94185036427, "grid": "P15", "hidden": false, "label": "SR 17"}, "SR 80": {"type": "sensor_relay", "x": 91036.62298134179, "y": 106200.88629480873, "grid": "R16", "hidden": false, "label": "SR 80"}, "SR 32": {"type": "sensor_relay", "x": 24543.567425786197, "y": -5778.280371857953, "grid": "L13", "hidden": false, "label": "SR 32"}, "SR 64": {"type": "sensor_relay", "x": 165376.9007591195, "y": 136582.83073925317, "grid": "S20", "hidden": false, "label": "SR 64"}, "SR 95": {"type": "sensor_relay", "x": 148433.94184276255, "y": 171765.24745031452, "grid": "U19", "hidden": false, "label": "SR 95"}, "SR 16": {"type": "sensor_relay", "x": 110363.45873108538, "y": 180454.58678743523, "grid": "V17", "hidden": false, "label": "SR 16"}, "SR 79": {"type": "sensor_relay", "x": 79833.30170351069, "y": 156107.5989995433, "grid": "T15", "hidden": false, "label": "SR 79"}, "SR 73": {"type": "sensor_relay", "x": 79833.30170351069, "y": 117058.06247896305, "grid": "R15", "hidden": false, "label": "SR 73"}, "SR 60": {"type": "sensor_relay", "x": 110363.45873108538, "y": 92711.07469107112, "grid": "Q17", "hidden": false, "label": "SR 60"}, "SR 58": {"type": "sensor_relay", "x": 148433.94184276255, "y": 101400.41402819182, "grid": "R19", "hidden": false, "label": "SR 58"}, "SR 59": {"type": "sensor_relay", "x": -74900.87701865824, "y": -107861.6137051913, "grid": "G08", "hidden": false, "label": "SR 59"}, "SR 24": {"type": "sensor_relay", "x": -91843.83593501523, "y": -72679.19699412995, "grid": "I07", "hidden": false, "label": "SR 24"}, "SR 44": {"type": "sensor_relay", "x": -129914.3190466924, "y": -63989.857657009234, "grid": "I05", "hidden": false, "label": "SR 44"}, "SR 65": {"type": "sensor_relay", "x": -160444.47607426712, "y": -88336.84544490118, "grid": "H03", "hidden": false, "label": "SR 65"}, "SR 41": {"type": "sensor_relay", "x": -160444.47607426712, "y": -127386.38196548141, "grid": "F03", "hidden": false, "label": "SR 41"}, "SR 51": {"type": "sensor_relay", "x": -129914.3190466924, "y": -151733.36975337335, "grid": "E05", "hidden": false, "label": "SR 51"}, "SR 26": {"type": "sensor_relay", "x": -91843.83593501525, "y": -143044.03041625264, "grid": "E07", "hidden": false, "label": "SR 26"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p class="hull-desc">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else if (obj.type === 'planet') {
            if (obj['class']) {
                infoHtml += '<b>Class:</b> ' + obj['class'] + '<br>';
            }
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p class="desc-text">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [-158797.30438558204, -219277.30438558199, -199511.5536391093, -139031.55363910936, -158797.30438558204], "y": [329529.93654773734, -62150.06345226269, -65202.12790576214, 326477.8720942378, 329529.93654773734], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-72190.478571402, -217630.47857140197, -189638.37945328938, -44198.37945328941, -72190.478571402], "y": [308919.3280059673, -68360.67199403269, -79151.51936399212, 298128.48063600785, 308919.3280059673], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [75560.2559041021, 307400.2559041022, 209810.88607120654, -22029.113928793508, 75560.2559041021], "y": [-210911.4035525595, 113088.5964474405, 182919.21219453472, -141080.78780546528, -210911.4035525595], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [72700.95879862393, 105832.10077393262, 88819.04120137598, 55687.89922606729, 72700.95879862393], "y": [2738.8196737831167, 56346.628315758324, 66861.1803262169, 13253.37168424169, 2738.8196737831167], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-81311.06945621605, -2111.0694562160647, 5699.927480907325, -73500.07251909266, -81311.06945621605], "y": [116390.27786025983, 82790.27786025983, 101201.91349776495, 134801.91349776497, 116390.27786025983], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-3570.0425646697404, -247170.04256466974, -270041.09941063897, -26441.09941063897, -3570.0425646697404], "y": [-292503.23204634164, -92103.2320463416, -119904.57659563354, -320304.5765956335, -292503.23204634164], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-49934.503175788894, -251534.50317578885, -265676.6387995198, -64076.638799519846, -49934.503175788894], "y": [-320932.8365091221, -119332.83650912212, -133474.97213285306, -335074.97213285306, -320932.8365091221], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-114361.09567901239], "y": [-102522.76234567909], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Rose Gate [G06]"], "hoverinfo": "text", "text": ["Rose Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [116472.23765432095], "y": [130810.57098765427], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Delphinium Gate [S17]"], "hoverinfo": "text", "text": ["Delphinium Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-13791.377425841114], "y": [-6093.905340290381], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 82 [L11]"], "hoverinfo": "text", "text": ["DS 82"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-24.0329218107654], "y": [-11068.287037037153], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Happy Eater Trading [L11]"], "hoverinfo": "text", "text": ["Happy Eater Trading"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-1756.45808790694], "y": [-13479.963052217732], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["HET S07 [L11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [2729.8081034776696], "y": [-11797.613230448507], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["HET S08 [L12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-146968.63095030186], "y": [-135919.7937101231], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Happy Eater [F04]"], "hoverinfo": "text", "text": ["Happy Eater"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-165057.25623396458], "y": [-145448.623100624], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["IMO 31 [E03]"], "hoverinfo": "text", "text": ["IMO 31"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [157726.84251572317], "y": [158291.99008119857], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["IMO 224 [T19]"], "hoverinfo": "text", "text": ["IMO 224"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-162488.36521231313], "y": [-146207.80693986674], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 74 [E03]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-161196.32054919435], "y": [-148468.88510032458], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Vita Refinery [E03]"], "hoverinfo": "text", "text": ["Vita Refinery"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [197728.23765432087], "y": [-66530.76234567916], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["JP 31 [I21]"], "hoverinfo": "text", "text": ["**JP 31**"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "gmOnly": true, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-21289.56995408448], "y": [-492.718536792323], "mode": "markers", "marker": {"symbol": "pentagon-open", "size": 3, "color": "orange"}, "hovertext": ["WP 53 [L10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-59136.98812976935], "y": [-45708.83592741351], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 23 [J09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-29102.265907547117], "y": [-15326.891482969062], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 61 [L10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [932.4563146751025], "y": [15055.05296147539], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 50 [M12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [30967.17853689732], "y": [45436.99740591983], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 70 [O13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [61001.90075911957], "y": [75818.94185036427], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 17 [P15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [91036.62298134179], "y": [106200.88629480873], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 80 [R16]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [24543.567425786197], "y": [-5778.280371857953], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 32 [L13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [165376.9007591195], "y": [136582.83073925317], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 64 [S20]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [148433.94184276255], "y": [171765.24745031452], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 95 [U19]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [110363.45873108538], "y": [180454.58678743523], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 16 [V17]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [79833.30170351069], "y": [156107.5989995433], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 79 [T15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [79833.30170351069], "y": [117058.06247896305], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 73 [R15]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [110363.45873108538], "y": [92711.07469107112], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 60 [Q17]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [148433.94184276255], "y": [101400.41402819182], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 58 [R19]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-74900.87701865824], "y": [-107861.6137051913], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 59 [G08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-91843.83593501523], "y": [-72679.19699412995], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 24 [I07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-129914.3190466924], "y": [-63989.857657009234], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 44 [I05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-160444.47607426712], "y": [-88336.84544490118], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 65 [H03]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-160444.47607426712], "y": [-127386.38196548141], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 41 [F03]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-129914.3190466924], "y": [-151733.36975337335], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 51 [E05]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-91843.83593501525], "y": [-143044.03041625264], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 26 [E07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}], "layout": {"title": "Waypoint 60", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Waypoint 60';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Use Plotly's built-in nearest-point selection for accurate clicks
    plotDiv.on('plotly_click', function(ev) {
        if (!ev || !ev.points || !ev.points.length) return;
        var p = ev.points[0];
        var picked = null;
        // Prefer original name from hovertext: "Name [Grid]"
        if (p.hovertext && typeof p.hovertext === 'string') {
            picked = p.hovertext.split(' [')[0];
        } else if (p.text && typeof p.text === 'string') {
            // Fallback to text label (strip any ** used for GM marking)
            picked = p.text.replace(/\*/g, '');
        }
        if (picked && objData[picked]) {
            highlight(picked);
        }
    });

    // ——— Auto-scale markers based on current zoom/span (optimized: planets & blackholes only) ———
    (function() {
        var refSpan = null;
        var planetIdx = [];
        var bhIdx = [];
        function rescaleMarkers() {
            try {
                var full = plotDiv._fullLayout || {};
                var xaxis = full.xaxis || (fig.layout && fig.layout.xaxis);
                if (!xaxis || !xaxis.range) return;
                var curr = Math.abs(xaxis.range[1] - xaxis.range[0]);
                if (!curr) return;
                if (!refSpan) refSpan = curr;
                var scale = refSpan / curr;
                var indices = [];
                var markerSizes = [];
                var textSizes = [];
                function pushForIndex(i) {
                    var t = fig.data[i];
                    if (!t || !t.meta || !t.meta.base_marker_size) return;
                    var base = t.meta.base_marker_size;
                    var baseText = t.meta.base_text_size || (t.textfont && t.textfont.size) || 12;
                    var newMarker = Math.max(2, Math.round(base * scale));
                    var newText = Math.max(8, Math.round(baseText * Math.sqrt(scale)));
                    indices.push(i);
                    markerSizes.push(newMarker);
                    textSizes.push(newText);
                }
                planetIdx.forEach(pushForIndex);
                bhIdx.forEach(pushForIndex);
                if (indices.length) {
                    Plotly.restyle(plotDiv, {'marker.size': [markerSizes], 'textfont.size': [textSizes]}, indices);
                }
            } catch (e) { console.error(e); }
        }
        // initial scale after plot settles
        setTimeout(rescaleMarkers, 250);
        plotDiv.on('plotly_relayout', rescaleMarkers);
    })();

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Delphinium Gate',function(){highlight('Delphinium Gate');},false,null,false)
    addButton('JP 31',function(){highlight('JP 31');},false,null,true)
    addButton('Rose Gate',function(){highlight('Rose Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

    addButton('--- Planets ---', null, true, null);
    

    addButton('--- Stations ---', null, true, null);
    addButton('DS 82',function(){highlight('DS 82');},false,'blue',false)
    addButton('Happy Eater',function(){highlight('Happy Eater');},false,'blue',false)
    addButton('Happy Eater Trading',function(){highlight('Happy Eater Trading');},false,'blue',false)
    addButton('IMO 224',function(){highlight('IMO 224');},false,'blue',false)
    addButton('IMO 31',function(){highlight('IMO 31');},false,'blue',false)
    addButton('Vita Refinery',function(){highlight('Vita Refinery');},false,'blue',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>