
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackspire.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        /* === Description typography controls ===
           Tweak these two variables to change description sizes globally */
        :root {
            --desc-font-size: 130%;
            --hull-desc-font-size: 130%;
        }
        .desc-text { font-size: var(--desc-font-size); margin-top: 8px; }
        .hull-desc { font-size: var(--hull-desc-font-size); margin-top: 5px; color: #ccc; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Blackspire</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Huey": {"type": "blackhole", "x": -141379.4112860717, "y": 133890.14347790077, "grid": "S04"}, "Louie": {"type": "blackhole", "x": 137417.21854304636, "y": -139900.66225165562, "grid": "F18"}, "Dewey": {"type": "blackhole", "x": 181291.3907284768, "y": 123344.37086092714, "grid": "S21"}, "Newton Gate": {"type": "jumpnode", "x": 50000.00000000001, "y": 118333.33333333334, "grid": "R14", "hidden": false, "label": "Newton Gate", "destinations": {"Zephhyr Gate": "Brightfall"}}, "Ashes": {"type": "jumpnode", "x": -72500.0, "y": -179166.6666666667, "grid": "D08", "hidden": false, "label": "Ashes", "destinations": {"Temple Point Gate": "Vesper Point"}}, "DS 15": {"type": "station", "x": -77419.57983253319, "y": 32855.804541037935, "grid": "N08", "hidden": false, "label": "DS 15", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 16": {"type": "station", "x": 169811.40518626483, "y": 73434.5314808729, "grid": "P20", "hidden": false, "label": "DS 16", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 17": {"type": "station", "x": 96532.49381604689, "y": -94821.76162421779, "grid": "H16", "hidden": false, "label": "DS 17", "hull": "starbase_civil", "facilities": ["Docking", "Refuel"], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Port Cat": {"type": "station", "x": -18979.411286071696, "y": 282690.14347790077, "grid": "A11", "hidden": true, "label": "**Port Cat**", "hull": "pirate_military_base", "facilities": [], "sides": ["Pirate"], "hullName": "Pirate Base", "hullImage": "Images/Ships/TSN Mod/Pirate/PirateBaseAst256.png", "hullDescription": ""}, "Port March": {"type": "station", "x": 215902.39164936633, "y": -308897.51346184855, "grid": "W22", "hidden": true, "label": "**Port March**", "hull": "starbase_civil", "facilities": [], "sides": ["Pirate"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 73": {"type": "station", "x": 219484.87400294677, "y": -307729.75775746093, "grid": "W22", "hidden": true, "label": "**DS 73**", "hull": "usfp_industrial_assembly", "facilities": [], "sides": ["Pirate"], "hullName": "Assembly Yard", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialAssembler256.png", "hullDescription": ""}, "DS 39": {"type": "station", "x": 216997.45955918336, "y": -312916.06009455916, "grid": "W22", "hidden": true, "label": "**DS 39**", "hull": "usfp_industrial_assembly", "facilities": [], "sides": ["Pirate"], "hullName": "Assembly Yard", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialAssembler256.png", "hullDescription": ""}, "DS 66": {"type": "station", "x": 221008.41000154096, "y": -310626.09121061885, "grid": "W23", "hidden": true, "label": "**DS 66**", "hull": "pirate_cache_1", "facilities": [], "sides": ["Pirate"], "hullName": "Cache", "hullImage": "Images/Ships/TSN Mod/Pirate/PirateCache256.png", "hullDescription": ""}, "JP 34": {"type": "jumppoint", "x": -62801.26342609975, "y": 309728.4684381927, "grid": "B08", "hidden": true, "label": "**JP 34**", "destinations": {"Newton Gate": "Blackspire", "JP 17": "Tiridian"}}, "RS 16": {"type": "station", "x": 173020.5887139283, "y": 82690.14347790078, "grid": "Q20", "hidden": false, "label": "RS 16", "hull": "starbase_science", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "RS 15": {"type": "station", "x": -89691.35802469139, "y": 46246.14197530863, "grid": "O07", "hidden": false, "label": "RS 15", "hull": "starbase_science", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "SM 15 B": {"type": "station", "x": -66060.95679012348, "y": 39494.598765432085, "grid": "N08", "hidden": false, "label": "SM 15 B", "hull": "usfp_industrial_storage", "facilities": [], "sides": ["USFP"], "hullName": "Storage Module", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialStorage256.png", "hullDescription": ""}, "SM 15 A": {"type": "station", "x": -88244.59876543214, "y": 24062.499999999985, "grid": "N07", "hidden": false, "label": "SM 15 A", "hull": "usfp_industrial_storage", "facilities": [], "sides": ["USFP"], "hullName": "Storage Module", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialStorage256.png", "hullDescription": ""}, "RS 17": {"type": "station", "x": 111020.5887139283, "y": -106309.8565220992, "grid": "G17", "hidden": false, "label": "RS 17", "hull": "starbase_science", "facilities": ["Docking"], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "SR 61": {"type": "sensor_relay", "x": 59145.660122084824, "y": 133890.53826639222, "grid": "S14", "hidden": false, "label": "SR 61"}, "SR 24": {"type": "sensor_relay", "x": 41333.160122084824, "y": 93369.70493305888, "grid": "Q14", "hidden": false, "label": "SR 24"}, "SR 86": {"type": "sensor_relay", "x": 23520.660122084824, "y": 52848.87159972555, "grid": "O13", "hidden": false, "label": "SR 86"}, "SR 95": {"type": "sensor_relay", "x": 5708.160122084824, "y": 12328.038266392221, "grid": "M12", "hidden": false, "label": "SR 95"}, "SR 58": {"type": "sensor_relay", "x": -12104.339877915176, "y": -28192.795066941122, "grid": "K11", "hidden": false, "label": "SR 58"}, "SR 10": {"type": "sensor_relay", "x": -29916.839877915176, "y": -68713.62840027447, "grid": "I10", "hidden": false, "label": "SR 10"}, "SR 57": {"type": "sensor_relay", "x": -47729.339877915176, "y": -109234.46173360778, "grid": "G09", "hidden": false, "label": "SR 57"}, "SR 51": {"type": "sensor_relay", "x": -65541.83987791518, "y": -149755.29506694115, "grid": "E08", "hidden": false, "label": "SR 51"}, "SR 59": {"type": "sensor_relay", "x": -83354.33987791518, "y": -190276.12840027447, "grid": "C07", "hidden": false, "label": "SR 59"}, "SR 62": {"type": "sensor_relay", "x": -28354.339877915183, "y": 28890.538266392225, "grid": "N10", "hidden": false, "label": "SR 62"}, "SR 96": {"type": "sensor_relay", "x": -68354.33987791519, "y": 52223.87159972556, "grid": "O08", "hidden": false, "label": "SR 96"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p class="hull-desc">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else if (obj.type === 'planet') {
            if (obj['class']) {
                infoHtml += '<b>Class:</b> ' + obj['class'] + '<br>';
            }
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p class="desc-text">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [-85782.69284233495, -98057.11714196324, -117185.93675977518, -104911.51246014689, -85782.69284233495], "y": [11841.764304362607, 52056.65444393421, 46218.139219220524, 6003.249079648924, 11841.764304362607], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-58410.829083642224, -100886.79738367166, -89807.4079188102, -47331.43961878077, -58410.829083642224], "y": [44380.814415381465, 16117.337409658452, -533.4021861047622, 27730.074819618254, 44380.814415381465], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-91420.45376776691, -60163.30927759772, -43317.8812643675, -74575.02575453668, -91420.45376776691], "y": [80549.46005161866, 31710.171785729297, 42491.245714196644, 91330.53398008601, 80549.46005161866], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-108678.68555471547, -78537.86765348089, -95271.89799136498, -125412.71589259956, -108678.68555471547], "y": [36647.586653224855, 82696.05844677766, 93649.24194066544, 47600.77014711261, 36647.586653224855], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [195660.65866063387, 153660.65866063387, 144380.51876722273, 186380.51876722273, 195660.65866063387], "y": [94548.45883070234, 116548.45883070234, 98831.82812509923, 76831.82812509923, 94548.45883070234], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [228279.59048357813, 176279.59048357813, 185761.58694427848, 237761.58694427848, 228279.59048357813], "y": [133494.85447712254, 105494.85447712254, 87885.43247867902, 115885.43247867902, 133494.85447712254], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [168873.93483059946, 210873.93483059946, 227167.24259725714, 185167.24259725714, 168873.93483059946], "y": [174890.8305440057, 115890.83054400569, 127489.45641179591, 186489.4564117959, 174890.8305440057], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [126198.7661127112, 185198.7661127112, 182842.4113151454, 123842.41131514541, 126198.7661127112], "y": [156759.79111673066, 163759.79111673066, 183620.49583907094, 176620.49583907094, 156759.79111673066], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-28891.02744389866, 132108.97255610133, 137932.20487175527, -23067.79512824474, -28891.02744389866], "y": [206123.4046736122, 157123.4046736122, 176256.88228218938, 225256.88228218938, 206123.4046736122], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [127087.18162699771, 95087.18162699771, 96953.99580085889, 128953.99580085889, 127087.18162699771], "y": [-219353.51426150632, -222353.51426150632, -242266.19878269208, -239266.19878269208, -219353.51426150632], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [182544.4030914014, 115544.40309140139, 118496.77433645522, 185496.77433645522, 182544.4030914014], "y": [-208419.41285116892, -218419.41285116892, -238200.30019302948, -228200.30019302948, -208419.41285116892], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [177866.1761740281, 128866.1761740281, 113175.0012538285, 162175.0012538285, 177866.1761740281], "y": [-250109.31159395582, -188109.31159395582, -200510.40145024259, -262510.4014502426, -250109.31159395582], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [153354.70883534368, 101354.70883534368, 98686.46859251292, 150686.46859251292, 153354.70883534368], "y": [-211399.2499058706, -204399.2499058706, -224220.46313832782, -231220.46313832782, -211399.2499058706], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-35148.71586425826, 108851.28413574173, 113189.89329211487, -30810.106707885137, -35148.71586425826], "y": [-182071.72712393873, -214071.72712393873, -194547.98592025967, -162547.98592025967, -182071.72712393873], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-228979.4112860717, -228979.4112860717, -248979.4112860717, -248979.4112860717, -228979.4112860717], "y": [58690.1434779008, 156690.1434779008, 156690.1434779008, 58690.1434779008, 58690.1434779008], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-135276.548706384, -166276.548706384, -179682.2738657594, -148682.2738657594, -135276.548706384], "y": [-38888.83009458783, -10888.830094587827, -25730.88294961059, -53730.88294961059, -38888.83009458783], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-190996.66135471224, -222996.66135471224, -228962.16121743116, -196962.16121743116, -190996.66135471224], "y": [-176765.0567417489, -166765.0567417489, -185854.6563024495, -195854.6563024495, -176765.0567417489], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-67376.4632784997, -101989.78319935407, -117969.03937278932, -83355.71945193494, -67376.4632784997], "y": [-220281.51091446658, -174296.05214916414, -186323.66089503426, -232309.1196603367, -220281.51091446658], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [103117.80950775892, 16117.809507758922, 29923.367920097677, 116923.36792009768, 103117.80950775892], "y": [8925.586742198808, -74074.41325780118, -88545.29978639723, -5545.2997863972405, 8925.586742198808], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [212244.163772837, 160244.163772837, 123797.0136550196, 175797.0136550196, 212244.163772837], "y": [-91069.63127807093, 23930.368721929077, 7449.918233872519, -107550.08176612748, -91069.63127807093], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [218039.1386622386, 193609.44035444, 201565.38932223257, 225995.08763003116, 218039.1386622386], "y": [-290599.8935591773, -301192.1059251047, -319541.57120401354, -308949.35883808613, -290599.8935591773], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [222032.1628555601, 206389.94421951132, 192336.65709305517, 207978.87572910395, 222032.1628555601], "y": [-318497.19795185723, -303049.6957303651, -317280.1251315245, -332727.62735301664, -318497.19795185723], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [230128.5671776997, 210592.02025051852, 214875.63532782433, 234412.18225500552, 230128.5671776997], "y": [-307212.0444989943, -311495.80561924, -331031.6865021047, -326747.925381859, -307212.0444989943], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [223773.14439530612, 220408.44475176767, 240190.61319610366, 243555.3128396421, 223773.14439530612], "y": [-294454.43150860973, -317065.2131131882, -320008.9881793096, -297398.2065747311, -294454.43150860973], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [176397.80456967463, 237161.6934585635, 226732.693269484, 165968.80438059513, 176397.80456967463], "y": [-314664.68940449966, -277531.20175017876, -260465.5650771396, -297599.0527314605, -314664.68940449966], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [159150.69331032858, 255119.05750785948, 229029.95884981775, 133061.59465228685, 159150.69331032858], "y": [-306754.1758020963, -240685.50296259014, -202789.65892645653, -268858.3317659627, -306754.1758020963], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [40091.633263395684, 90728.20733746975, 82849.82136588641, 32213.24729181233, 40091.633263395684], "y": [-212121.16087433355, -190419.77198544468, -172036.8713850835, -193738.26027397238, -212121.16087433355], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-759.5533782881266, 47948.008350106946, 37859.95862485416, -10847.603103540909, -759.5533782881266], "y": [-203366.09473425895, -174913.1626354935, -157643.78937700996, -186096.7214757754, -203366.09473425895], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [27208.50914555507, 21903.725194937782, 2175.84671829491, 7480.630668912196, 27208.50914555507], "y": [-195016.4305776426, -163187.7268739389, -166475.70662004602, -198304.41032374973, -195016.4305776426], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [166372.73116491278, 223085.6941278757, 218895.1123532582, 162182.1493902953, 166372.73116491278], "y": [-288614.37051739625, -276461.5927396185, -256905.5444580703, -269058.32223584806, -288614.37051739625], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [178384.98025801944, 166810.9061839454, 150169.90029718852, 161743.97437126256, 178384.98025801944], "y": [-167386.5666365921, -150025.45552548097, -161119.45944998553, -178480.57056109665, -167386.5666365921], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-141379.4112860717], "y": [133890.14347790077], "mode": "markers+text", "marker": {"symbol": "star", "size": 40, "color": "yellow"}, "text": ["Huey"], "textposition": "top center", "hovertext": ["Huey [S04]"], "hoverinfo": "text", "meta": {"base_marker_size": 140, "base_text_size": 14}}, {"type": "scatter", "x": [137417.21854304636], "y": [-139900.66225165562], "mode": "markers+text", "marker": {"symbol": "star", "size": 40, "color": "yellow"}, "text": ["Louie"], "textposition": "top center", "hovertext": ["Louie [F18]"], "hoverinfo": "text", "meta": {"base_marker_size": 140, "base_text_size": 14}}, {"type": "scatter", "x": [181291.3907284768], "y": [123344.37086092714], "mode": "markers+text", "marker": {"symbol": "star", "size": 40, "color": "yellow"}, "text": ["Dewey"], "textposition": "top center", "hovertext": ["Dewey [S21]"], "hoverinfo": "text", "meta": {"base_marker_size": 140, "base_text_size": 14}}, {"type": "scatter", "x": [50000.00000000001], "y": [118333.33333333334], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Newton Gate [R14]"], "hoverinfo": "text", "text": ["Newton Gate"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-72500.0], "y": [-179166.6666666667], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["Ashes [D08]"], "hoverinfo": "text", "text": ["Ashes"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [-77419.57983253319], "y": [32855.804541037935], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 15 [N08]"], "hoverinfo": "text", "text": ["DS 15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [169811.40518626483], "y": [73434.5314808729], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 16 [P20]"], "hoverinfo": "text", "text": ["DS 16"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [96532.49381604689], "y": [-94821.76162421779], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 17 [H16]"], "hoverinfo": "text", "text": ["DS 17"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-18979.411286071696], "y": [282690.14347790077], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Port Cat [A11]"], "hoverinfo": "text", "text": ["**Port Cat**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [215902.39164936633], "y": [-308897.51346184855], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Port March [W22]"], "hoverinfo": "text", "text": ["**Port March**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [219484.87400294677], "y": [-307729.75775746093], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 73 [W22]"], "hoverinfo": "text", "text": ["**DS 73**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [216997.45955918336], "y": [-312916.06009455916], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 39 [W22]"], "hoverinfo": "text", "text": ["**DS 39**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [221008.41000154096], "y": [-310626.09121061885], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 66 [W23]"], "hoverinfo": "text", "text": ["**DS 66**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-62801.26342609975], "y": [309728.4684381927], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "#50CC50", "line": {"color": "#50CC50", "width": 5}}, "hovertext": ["JP 34 [B08]"], "hoverinfo": "text", "text": ["**JP 34**"], "textposition": "top center", "textfont": {"color": "#50CC50", "size": 20}, "gmOnly": true, "meta": {"base_marker_size": 16, "base_text_size": 20}}, {"type": "scatter", "x": [173020.5887139283], "y": [82690.14347790078], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS 16 [Q20]"], "hoverinfo": "text", "text": ["RS 16"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-89691.35802469139], "y": [46246.14197530863], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS 15 [O07]"], "hoverinfo": "text", "text": ["RS 15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-66060.95679012348], "y": [39494.598765432085], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["SM 15 B [N08]"], "hoverinfo": "text", "text": ["SM 15 B"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [-88244.59876543214], "y": [24062.499999999985], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["SM 15 A [N07]"], "hoverinfo": "text", "text": ["SM 15 A"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [111020.5887139283], "y": [-106309.8565220992], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS 17 [G17]"], "hoverinfo": "text", "text": ["RS 17"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "meta": {"base_marker_size": 12, "base_text_size": 14}}, {"type": "scatter", "x": [59145.660122084824], "y": [133890.53826639222], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 61 [S14]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [41333.160122084824], "y": [93369.70493305888], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 24 [Q14]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [23520.660122084824], "y": [52848.87159972555], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 86 [O13]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [5708.160122084824], "y": [12328.038266392221], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 95 [M12]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-12104.339877915176], "y": [-28192.795066941122], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 58 [K11]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-29916.839877915176], "y": [-68713.62840027447], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 10 [I10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-47729.339877915176], "y": [-109234.46173360778], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 57 [G09]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-65541.83987791518], "y": [-149755.29506694115], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 51 [E08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-83354.33987791518], "y": [-190276.12840027447], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 59 [C07]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-28354.339877915183], "y": [28890.538266392225], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 62 [N10]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}, {"type": "scatter", "x": [-68354.33987791519], "y": [52223.87159972556], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 96 [O08]"], "hoverinfo": "text", "meta": {"base_marker_size": 3, "base_text_size": 14}}], "layout": {"title": "Blackspire", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Blackspire';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Use Plotly's built-in nearest-point selection for accurate clicks
    plotDiv.on('plotly_click', function(ev) {
        if (!ev || !ev.points || !ev.points.length) return;
        var p = ev.points[0];
        var picked = null;
        // Prefer original name from hovertext: "Name [Grid]"
        if (p.hovertext && typeof p.hovertext === 'string') {
            picked = p.hovertext.split(' [')[0];
        } else if (p.text && typeof p.text === 'string') {
            // Fallback to text label (strip any ** used for GM marking)
            picked = p.text.replace(/\*/g, '');
        }
        if (picked && objData[picked]) {
            highlight(picked);
        }
    });

    // ——— Auto-scale markers based on current zoom/span (optimized: planets & blackholes only) ———
    (function() {
        var refSpan = null;
        var planetIdx = [];
        var bhIdx = [31, 32, 33];
        function rescaleMarkers() {
            try {
                var full = plotDiv._fullLayout || {};
                var xaxis = full.xaxis || (fig.layout && fig.layout.xaxis);
                if (!xaxis || !xaxis.range) return;
                var curr = Math.abs(xaxis.range[1] - xaxis.range[0]);
                if (!curr) return;
                if (!refSpan) refSpan = curr;
                var scale = refSpan / curr;
                var indices = [];
                var markerSizes = [];
                var textSizes = [];
                function pushForIndex(i) {
                    var t = fig.data[i];
                    if (!t || !t.meta || !t.meta.base_marker_size) return;
                    var base = t.meta.base_marker_size;
                    var baseText = t.meta.base_text_size || (t.textfont && t.textfont.size) || 12;
                    var newMarker = Math.max(2, Math.round(base * scale));
                    var newText = Math.max(8, Math.round(baseText * Math.sqrt(scale)));
                    indices.push(i);
                    markerSizes.push(newMarker);
                    textSizes.push(newText);
                }
                planetIdx.forEach(pushForIndex);
                bhIdx.forEach(pushForIndex);
                if (indices.length) {
                    Plotly.restyle(plotDiv, {'marker.size': [markerSizes], 'textfont.size': [textSizes]}, indices);
                }
            } catch (e) { console.error(e); }
        }
        // initial scale after plot settles
        setTimeout(rescaleMarkers, 250);
        plotDiv.on('plotly_relayout', rescaleMarkers);
    })();

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Ashes',function(){highlight('Ashes');},false,null,false)
    addButton('JP 34',function(){highlight('JP 34');},false,null,true)
    addButton('Newton Gate',function(){highlight('Newton Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

    addButton('--- Planets ---', null, true, null);
    

    addButton('--- Stations ---', null, true, null);
    addButton('DS 15',function(){highlight('DS 15');},false,'blue',false)
    addButton('DS 16',function(){highlight('DS 16');},false,'blue',false)
    addButton('DS 17',function(){highlight('DS 17');},false,'blue',false)
    addButton('DS 39',function(){highlight('DS 39');},false,'red',true)
    addButton('DS 66',function(){highlight('DS 66');},false,'red',true)
    addButton('DS 73',function(){highlight('DS 73');},false,'red',true)
    addButton('Port Cat',function(){highlight('Port Cat');},false,'red',true)
    addButton('Port March',function(){highlight('Port March');},false,'red',true)
    addButton('RS 15',function(){highlight('RS 15');},false,'blue',false)
    addButton('RS 16',function(){highlight('RS 16');},false,'blue',false)
    addButton('RS 17',function(){highlight('RS 17');},false,'blue',false)
    addButton('SM 15 A',function(){highlight('SM 15 A');},false,'blue',false)
    addButton('SM 15 B',function(){highlight('SM 15 B');},false,'blue',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>