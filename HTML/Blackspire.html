
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackspire.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Blackspire</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Huey": {"type": "blackhole", "x": -113965.17100046808, "y": 114551.34910773719, "grid": "R06"}, "Louie": {"type": "blackhole", "x": 164831.45882864998, "y": -159239.4566218192, "grid": "E20"}, "Dewey": {"type": "blackhole", "x": 208705.63101408043, "y": 104005.57649076356, "grid": "R22"}, "Newton Gate": {"type": "jumpnode", "x": 64080.90695227029, "y": 53994.53896316976, "grid": "O15", "hidden": false, "label": "Newton Gate", "destinations": {"Zephhyr Gate": "Brightfall"}}, "Ashes": {"type": "jumpnode", "x": -15085.759714396387, "y": -144338.79437016358, "grid": "E11", "hidden": false, "label": "Ashes", "destinations": {"Temple Point Gate": "Vesper Point"}}, "DS 15": {"type": "station", "x": -50703.0436650137, "y": 10028.489580453686, "grid": "M09", "hidden": false, "label": "DS 15", "hull": "starbase_civil", "facilities": [], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "SM15A": {"type": "station", "x": -60830.358479828516, "y": 4723.705629836404, "grid": "M08", "hidden": false, "label": "SM15A", "hull": "usfp_industrial_storage", "facilities": [], "sides": ["USFP"], "hullName": "Storage Module", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialStorage256.png", "hullDescription": ""}, "SM15B": {"type": "station", "x": -38646.71650451986, "y": 20155.804395268504, "grid": "N10", "hidden": false, "label": "SM15B", "hull": "usfp_industrial_storage", "facilities": [], "sides": ["USFP"], "hullName": "Storage Module", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialStorage256.png", "hullDescription": ""}, "RS15": {"type": "station", "x": -62277.11773908777, "y": 26907.34760514505, "grid": "N08", "hidden": false, "label": "RS15", "hull": "starbase_command", "facilities": [], "sides": ["USFP"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}, "RS16": {"type": "station", "x": 200434.82899953192, "y": 63351.3491077372, "grid": "P22", "hidden": false, "label": "RS16", "hull": "starbase_science", "facilities": [], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "RS17": {"type": "station", "x": 138434.82899953192, "y": -125648.65089226278, "grid": "F18", "hidden": false, "label": "RS17", "hull": "starbase_science", "facilities": [], "sides": ["USFP"], "hullName": "Science Starbase", "hullImage": "Images/Ships/science_station256.png", "hullDescription": ""}, "DS 16": {"type": "station", "x": 194434.82899953192, "y": 49351.3491077372, "grid": "O21", "hidden": false, "label": "DS 16", "hull": "starbase_civil", "facilities": [], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 17": {"type": "station", "x": 117434.82899953192, "y": -107648.65089226278, "grid": "G17", "hidden": false, "label": "DS 17", "hull": "starbase_civil", "facilities": [], "sides": ["USFP"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "Port Cat": {"type": "station", "x": 8434.828999531925, "y": 263351.3491077372, "grid": "Z12", "hidden": true, "label": "**Port Cat**", "hull": "pirate_military_base", "facilities": [], "sides": ["USFP"], "hullName": "Pirate Base", "hullImage": "Images/Ships/TSN Mod/Pirate/PirateBaseAst256.png", "hullDescription": ""}, "Port March": {"type": "station", "x": 242381.99314509815, "y": -328610.16334796086, "grid": "V24", "hidden": true, "label": "**Port March**", "hull": "starbase_civil", "facilities": [], "sides": ["Pirate"], "hullName": "Civilian Starbase", "hullImage": "Images/Ships/civil_station256.png", "hullDescription": ""}, "DS 73": {"type": "station", "x": 246899.1142885504, "y": -327068.5521276245, "grid": "V24", "hidden": true, "label": "**DS 73**", "hull": "usfp_industrial_assembly", "facilities": [], "sides": ["Pirate"], "hullName": "Assembly Yard", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialAssembler256.png", "hullDescription": ""}, "DS 39": {"type": "station", "x": 244411.69984478698, "y": -332254.85446472274, "grid": "V24", "hidden": true, "label": "**DS 39**", "hull": "usfp_industrial_assembly", "facilities": [], "sides": ["Pirate"], "hullName": "Assembly Yard", "hullImage": "Images/Ships/TSN Mod/USFP/IndustrialAssembler256.png", "hullDescription": ""}, "DS 66": {"type": "station", "x": 248422.65028714458, "y": -329964.88558078243, "grid": "V24", "hidden": true, "label": "**DS 66**", "hull": "pirate_cache_1", "facilities": [], "sides": ["USFP"], "hullName": "Cache", "hullImage": "Images/Ships/TSN Mod/Pirate/PirateCache256.png", "hullDescription": ""}, "JP 34": {"type": "jumppoint", "x": -35387.02314049613, "y": 290389.6740680291, "grid": "A10", "hidden": true, "label": "**JP 34**", "destinations": {"Newton Gate": "Blackspire", "JP 17": "Tiridian"}}, "SR 31": {"type": "sensor_relay", "x": 68634.82899953186, "y": 63351.3491077372, "grid": "P15", "hidden": false, "label": "SR 31"}, "SR 29": {"type": "sensor_relay", "x": 53468.16233286519, "y": 27184.682441070538, "grid": "N14", "hidden": false, "label": "SR 29"}, "SR 95": {"type": "sensor_relay", "x": 38301.49566619852, "y": -8981.984225596127, "grid": "L13", "hidden": false, "label": "SR 95"}, "SR 27": {"type": "sensor_relay", "x": 7968.162332865191, "y": -81315.31755892946, "grid": "H12", "hidden": false, "label": "SR 27"}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p style="margin-top:5px; font-size:90%; color:#ccc;">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p style="font-size:90%; margin-top:8px;">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [-58368.45255673133, -70642.87685635962, -89771.69647417156, -77497.27217454326, -58368.45255673133], "y": [-7497.030065800975, 32717.86007377063, 26879.344849056943, -13335.545290514658, -7497.030065800975], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-30996.588798038603, -73472.55709806803, -62393.16763320658, -19917.199333177145, -30996.588798038603], "y": [25042.020045217883, -3221.456960505131, -19872.196556268347, 8391.28044945467, 25042.020045217883], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-64006.213482163286, -32749.0689919941, -15903.640978763871, -47160.78546893306, -64006.213482163286], "y": [61210.66568145508, 12371.377415565716, 23152.451344033063, 71991.73960992243, 61210.66568145508], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-81264.44526911185, -51123.62736787728, -67857.65770576136, -97998.47560699594, -81264.44526911185], "y": [17308.792283061273, 63357.26407661409, 74310.44757050186, 28261.97577694903, 17308.792283061273], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [223074.8989462375, 181074.8989462375, 171794.75905282635, 213794.75905282635, 223074.8989462375], "y": [75209.66446053876, 97209.66446053876, 79493.03375493565, 57493.03375493565, 75209.66446053876], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [255693.83076918175, 203693.83076918175, 213175.8272298821, 265175.8272298821, 255693.83076918175], "y": [114156.06010695896, 86156.06010695896, 68546.63810851544, 96546.63810851544, 114156.06010695896], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [196288.17511620309, 238288.17511620309, 254581.48288286076, 212581.48288286076, 196288.17511620309], "y": [155552.03617384212, 96552.0361738421, 108150.66204163233, 167150.6620416323, 155552.03617384212], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [153613.0063983148, 212613.0063983148, 210256.65160074903, 151256.65160074903, 153613.0063983148], "y": [137420.99674656708, 144420.99674656708, 164281.70146890735, 157281.70146890735, 137420.99674656708], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-1476.7871582950393, 159523.21284170495, 165346.4451573589, 4346.445157358881, -1476.7871582950393], "y": [186784.61030344863, 137784.61030344863, 156918.0879120258, 205918.0879120258, 186784.61030344863], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [154501.42191260133, 122501.42191260133, 124368.23608646251, 156368.2360864625, 154501.42191260133], "y": [-238692.3086316699, -241692.3086316699, -261604.99315285566, -258604.99315285566, -238692.3086316699], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [209958.643377005, 142958.643377005, 145911.01462205884, 212911.01462205884, 209958.643377005], "y": [-227758.2072213325, -237758.2072213325, -257539.09456319307, -247539.09456319307, -227758.2072213325], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [205280.41645963173, 156280.41645963173, 140589.2415394321, 189589.2415394321, 205280.41645963173], "y": [-269448.10596411943, -207448.1059641194, -219849.19582040617, -281849.1958204062, -269448.10596411943], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [180768.9491209473, 128768.9491209473, 126100.70887811654, 178100.70887811654, 180768.9491209473], "y": [-230738.04427603417, -223738.04427603417, -243559.2575084914, -250559.2575084914, -230738.04427603417], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-7734.475578654641, 136265.52442134536, 140604.1335777185, -3395.8664222815173, -7734.475578654641], "y": [-201410.52149410232, -233410.52149410232, -213886.78029042325, -181886.78029042325, -201410.52149410232], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-201565.17100046808, -201565.17100046808, -221565.17100046808, -221565.17100046808, -201565.17100046808], "y": [39351.34910773722, 137351.34910773722, 137351.34910773722, 39351.34910773722, 39351.34910773722], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-107862.30842078038, -138862.30842078038, -152268.03358015578, -121268.03358015578, -107862.30842078038], "y": [-58227.6244647514, -30227.624464751403, -45069.677319774164, -73069.67731977417, -58227.6244647514], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-163582.42106910862, -195582.42106910862, -201547.92093182754, -169547.92093182754, -163582.42106910862], "y": [-196103.8511119125, -186103.8511119125, -205193.45067261308, -215193.45067261308, -196103.8511119125], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-43330.09499036572, -74330.09499036572, -90800.24701057044, -59800.24701057044, -43330.09499036572], "y": [-238975.59852974783, -193975.59852974783, -205321.70325477773, -250321.70325477773, -238975.59852974783], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [130532.04979336254, 43532.049793362545, 57337.6082057013, 144337.6082057013, 130532.04979336254], "y": [-10413.207627964759, -93413.20762796476, -107884.09415656081, -24884.09415656081, -10413.207627964759], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [239658.40405844062, 187658.40405844062, 151211.25394062322, 203211.25394062322, 239658.40405844062], "y": [-110408.42564823451, 4591.5743517654955, -11888.876136291063, -126888.87613629106, -110408.42564823451], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [245453.37894784223, 221023.68064004363, 228979.6296078362, 253409.32791563479, 245453.37894784223], "y": [-309938.6879293409, -320530.9002952683, -338880.3655741771, -328288.1532082497, -309938.6879293409], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [249446.40314116373, 233804.18450511494, 219750.8973786588, 235393.11601470757, 249446.40314116373], "y": [-337835.9923220208, -322388.4901005287, -336618.9195016881, -352066.4217231802, -337835.9923220208], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [257542.80746330332, 238006.26053612214, 242289.87561342795, 261826.42254060914, 257542.80746330332], "y": [-326550.8388691579, -330834.59998940356, -350370.48087226826, -346086.7197520226, -326550.8388691579], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [251187.38468090974, 247822.6850373713, 267604.8534817073, 270969.55312524573, 251187.38468090974], "y": [-313793.2258787733, -336404.0074833518, -339347.78254947317, -316737.0009448947, -313793.2258787733], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [203812.04485527825, 264575.9337441671, 254146.93355508763, 193383.04466619875, 203812.04485527825], "y": [-334003.48377466324, -296869.99612034234, -279804.35944730317, -316937.84710162407, -334003.48377466324], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [186564.93359593218, 282533.2977934631, 256444.19913542134, 160475.83493789044, 186564.93359593218], "y": [-326092.9701722599, -260024.29733275372, -222128.4532966201, -288197.1261361263, -326092.9701722599], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [67505.8735489993, 118142.44762307337, 110264.06165149003, 59627.48757741595, 67505.8735489993], "y": [-231459.95524449713, -209758.56635560826, -191375.6657552471, -213077.05464413596, -231459.95524449713], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [26654.686907315496, 75362.24863571057, 65274.19891045778, 16566.63718206271, 26654.686907315496], "y": [-222704.88910442253, -194251.95700565708, -176982.58374717354, -205435.515845939, -222704.88910442253], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [54622.749431158685, 49317.96548054141, 29590.087003898538, 34894.87095451581, 54622.749431158685], "y": [-214355.2249478062, -182526.52124410248, -185814.5009902096, -217643.2046939133, -214355.2249478062], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [193786.9714505164, 250499.93441347932, 246309.35263886183, 189596.3896758989, 193786.9714505164], "y": [-307953.16488755983, -295800.3871097821, -276244.3388282339, -288397.11660601164, -307953.16488755983], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [205799.22054362306, 194225.146469549, 177584.14058279214, 189158.21465686618, 205799.22054362306], "y": [-186725.36100675567, -169364.24989564455, -180458.2538201491, -197819.36493126024, -186725.36100675567], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-113965.17100046808], "y": [114551.34910773719], "mode": "markers+text", "marker": {"symbol": "star", "size": 14, "color": "yellow"}, "text": ["Huey"], "textposition": "top center", "hovertext": ["Huey [R06]"], "hoverinfo": "text"}, {"type": "scatter", "x": [164831.45882864998], "y": [-159239.4566218192], "mode": "markers+text", "marker": {"symbol": "star", "size": 14, "color": "yellow"}, "text": ["Louie"], "textposition": "top center", "hovertext": ["Louie [E20]"], "hoverinfo": "text"}, {"type": "scatter", "x": [208705.63101408043], "y": [104005.57649076356], "mode": "markers+text", "marker": {"symbol": "star", "size": 14, "color": "yellow"}, "text": ["Dewey"], "textposition": "top center", "hovertext": ["Dewey [R22]"], "hoverinfo": "text"}, {"type": "scatter", "x": [64080.90695227029], "y": [53994.53896316976], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["Newton Gate [O15]"], "hoverinfo": "text", "text": ["Newton Gate"], "textposition": "top center", "textfont": {"color": "white", "size": 20}}, {"type": "scatter", "x": [64080.90695227029], "y": [53994.53896316976], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["Newton Gate [O15]"], "hoverinfo": "text", "text": ["Newton Gate"], "textposition": "top center", "textfont": {"color": "white", "size": 20}}, {"type": "scatter", "x": [-15085.759714396387], "y": [-144338.79437016358], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["Ashes [E11]"], "hoverinfo": "text", "text": ["Ashes"], "textposition": "top center", "textfont": {"color": "white", "size": 20}}, {"type": "scatter", "x": [-15085.759714396387], "y": [-144338.79437016358], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["Ashes [E11]"], "hoverinfo": "text", "text": ["Ashes"], "textposition": "top center", "textfont": {"color": "white", "size": 20}}, {"type": "scatter", "x": [-50703.0436650137], "y": [10028.489580453686], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 15 [M09]"], "hoverinfo": "text", "text": ["DS 15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-50703.0436650137], "y": [10028.489580453686], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 15 [M09]"], "hoverinfo": "text", "text": ["DS 15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-60830.358479828516], "y": [4723.705629836404], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["SM15A [M08]"], "hoverinfo": "text", "text": ["SM15A"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-60830.358479828516], "y": [4723.705629836404], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["SM15A [M08]"], "hoverinfo": "text", "text": ["SM15A"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-38646.71650451986], "y": [20155.804395268504], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["SM15B [N10]"], "hoverinfo": "text", "text": ["SM15B"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-38646.71650451986], "y": [20155.804395268504], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["SM15B [N10]"], "hoverinfo": "text", "text": ["SM15B"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-62277.11773908777], "y": [26907.34760514505], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS15 [N08]"], "hoverinfo": "text", "text": ["RS15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [-62277.11773908777], "y": [26907.34760514505], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS15 [N08]"], "hoverinfo": "text", "text": ["RS15"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [200434.82899953192], "y": [63351.3491077372], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS16 [P22]"], "hoverinfo": "text", "text": ["RS16"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [200434.82899953192], "y": [63351.3491077372], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS16 [P22]"], "hoverinfo": "text", "text": ["RS16"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [138434.82899953192], "y": [-125648.65089226278], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS17 [F18]"], "hoverinfo": "text", "text": ["RS17"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [138434.82899953192], "y": [-125648.65089226278], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["RS17 [F18]"], "hoverinfo": "text", "text": ["RS17"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [194434.82899953192], "y": [49351.3491077372], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 16 [O21]"], "hoverinfo": "text", "text": ["DS 16"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [194434.82899953192], "y": [49351.3491077372], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 16 [O21]"], "hoverinfo": "text", "text": ["DS 16"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [117434.82899953192], "y": [-107648.65089226278], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 17 [G17]"], "hoverinfo": "text", "text": ["DS 17"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [117434.82899953192], "y": [-107648.65089226278], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 17 [G17]"], "hoverinfo": "text", "text": ["DS 17"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [8434.828999531925], "y": [263351.3491077372], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Port Cat [Z12]"], "hoverinfo": "text", "text": ["**Port Cat**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [8434.828999531925], "y": [263351.3491077372], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Port Cat [Z12]"], "hoverinfo": "text", "text": ["**Port Cat**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [242381.99314509815], "y": [-328610.16334796086], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Port March [V24]"], "hoverinfo": "text", "text": ["**Port March**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [242381.99314509815], "y": [-328610.16334796086], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["Port March [V24]"], "hoverinfo": "text", "text": ["**Port March**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [246899.1142885504], "y": [-327068.5521276245], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 73 [V24]"], "hoverinfo": "text", "text": ["**DS 73**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [246899.1142885504], "y": [-327068.5521276245], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 73 [V24]"], "hoverinfo": "text", "text": ["**DS 73**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [244411.69984478698], "y": [-332254.85446472274], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 39 [V24]"], "hoverinfo": "text", "text": ["**DS 39**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [244411.69984478698], "y": [-332254.85446472274], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "red"}, "hovertext": ["DS 39 [V24]"], "hoverinfo": "text", "text": ["**DS 39**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [248422.65028714458], "y": [-329964.88558078243], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 66 [V24]"], "hoverinfo": "text", "text": ["**DS 66**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [248422.65028714458], "y": [-329964.88558078243], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["DS 66 [V24]"], "hoverinfo": "text", "text": ["**DS 66**"], "textposition": "top center", "textfont": {"color": "white", "size": 14}, "gmOnly": true}, {"type": "scatter", "x": [-35387.02314049613], "y": [290389.6740680291], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["JP 34 [A10]"], "hoverinfo": "text", "text": ["**JP 34**"], "textposition": "top center", "textfont": {"color": "white", "size": 20}, "gmOnly": true}, {"type": "scatter", "x": [-35387.02314049613], "y": [290389.6740680291], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["JP 34 [A10]"], "hoverinfo": "text", "text": ["**JP 34**"], "textposition": "top center", "textfont": {"color": "white", "size": 20}, "gmOnly": true}, {"type": "scatter", "x": [68634.82899953186], "y": [63351.3491077372], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 31 [P15]"], "hoverinfo": "text"}, {"type": "scatter", "x": [68634.82899953186], "y": [63351.3491077372], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 31 [P15]"], "hoverinfo": "text"}, {"type": "scatter", "x": [53468.16233286519], "y": [27184.682441070538], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 29 [N14]"], "hoverinfo": "text"}, {"type": "scatter", "x": [53468.16233286519], "y": [27184.682441070538], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 29 [N14]"], "hoverinfo": "text"}, {"type": "scatter", "x": [38301.49566619852], "y": [-8981.984225596127], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 95 [L13]"], "hoverinfo": "text"}, {"type": "scatter", "x": [38301.49566619852], "y": [-8981.984225596127], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 95 [L13]"], "hoverinfo": "text"}, {"type": "scatter", "x": [7968.162332865191], "y": [-81315.31755892946], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 27 [H12]"], "hoverinfo": "text"}, {"type": "scatter", "x": [7968.162332865191], "y": [-81315.31755892946], "mode": "markers", "marker": {"symbol": "circle", "size": 3, "color": "white"}, "hovertext": ["SR 27 [H12]"], "hoverinfo": "text"}], "layout": {"title": "Blackspire", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Blackspire';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Custom click: select nearest object within 10px of cursor
    plotDiv.addEventListener('click', function(evt) {
        var rect = plotDiv.getBoundingClientRect();
        var px = evt.clientX - rect.left;
        var py = evt.clientY - rect.top;
        var xaxis = plotDiv._fullLayout.xaxis;
        var yaxis = plotDiv._fullLayout.yaxis;
        var l2px = xaxis.l2p.bind(xaxis);
        var l2py = yaxis.l2p.bind(yaxis);
        var minDist = Infinity, closest = null;
        for (var name in objData) {
            var pt = objData[name];
            var xPx = l2px(pt.x);
            var yPx = l2py(pt.y);
            var dx = xPx - px, dy = yPx - py;
            var d = Math.sqrt(dx*dx + dy*dy);
            console.log(`${name}: data=(${pt.x}, ${pt.y}) -> screen=(${xPx.toFixed(1)}, ${yPx.toFixed(1)}), cursor=(${px.toFixed(1)}, ${py.toFixed(1)}), dx=${dx.toFixed(1)}, dy=${dy.toFixed(1)}, d=${d.toFixed(1)}`);
            if (d < minDist) {
                minDist = d;
                closest = name;
            }
        }
        if (minDist <= 35 && closest) {
            highlight(closest);
        }
    });

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('Ashes',function(){highlight('Ashes');},false,null,false)
    addButton('JP 34',function(){highlight('JP 34');},false,null,true)
    addButton('Newton Gate',function(){highlight('Newton Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

  addButton('--- Stations ---', null, true, null);
  addButton('DS 15',function(){highlight('DS 15');},false,'blue',false)
    addButton('DS 16',function(){highlight('DS 16');},false,'blue',false)
    addButton('DS 17',function(){highlight('DS 17');},false,'blue',false)
    addButton('DS 39',function(){highlight('DS 39');},false,'red',true)
    addButton('DS 66',function(){highlight('DS 66');},false,'blue',true)
    addButton('DS 73',function(){highlight('DS 73');},false,'red',true)
    addButton('Port Cat',function(){highlight('Port Cat');},false,'blue',true)
    addButton('Port March',function(){highlight('Port March');},false,'red',true)
    addButton('RS15',function(){highlight('RS15');},false,'blue',false)
    addButton('RS16',function(){highlight('RS16');},false,'blue',false)
    addButton('RS17',function(){highlight('RS17');},false,'blue',false)
    addButton('SM15A',function(){highlight('SM15A');},false,'blue',false)
    addButton('SM15B',function(){highlight('SM15B');},false,'blue',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>