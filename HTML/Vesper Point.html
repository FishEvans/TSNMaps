
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vesper Point.html</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; display: flex; height: 100vh; }
        #controls { flex: 1; min-width: 200px; max-width: 350px; overflow-y: auto; background: #333; padding: 10px; }
        #plot { flex: 3; min-width: 400px; }
        #info { flex: 1; min-width: 200px; background: #333; padding: 10px; overflow-y: auto; }
        h2.header { margin-top: 0; margin-bottom: 5px; text-align: center; }
        h3.subheader { margin-top: 0; margin-bottom: 15px; text-align: center; color: #ccc; }
        .alignment-image { display: block; max-width: 100%; height: auto; margin: 10px auto; }
        button { display: block; width: 100%; margin-bottom: 5px; background: #555; color: white; border: none; padding: 5px; text-align: left; cursor: pointer; font-size: 20px; }
        button.header { background: #444; cursor: default; font-size: 24px; }
    </style>
</head>
<body>
    <div id="controls">
        <div id="gm-controls" style="margin-bottom:10px;"></div>
        <h2 class="header">Vesper Point</h2>
        <h3 class="subheader">Alignment: USFP</h3>
        <img src="Images/Factions/USFP.png" alt="Alignment Logo" class="alignment-image" onerror="this.style.display='none';">

        <input type="text" id="search-box" placeholder="Search objects..." style="width: 95%; padding: 6px; margin-bottom: 10px; font-size: 16px;">
        <div id="object-buttons">
    </div>
    </div>
    <div id="plot"></div>
    <div id="info">
        <img src="Images/Compass.png" alt="Compass" style="display:block; max-width:100%; height:auto; margin-bottom:10px;">
        <button id="galactic-map-btn" title="Back to Galactic Map">Show Galactic Map</button>
        Select an object
    </div>
<script>
    var objData = {"Temple Point Gate": {"type": "jumppoint", "x": 126957.13578030645, "y": 56949.4793466731, "grid": "O18", "hidden": false, "label": "Temple Point Gate", "destinations": {"Ashes": "Blackspire", "Long Bar Gate": "Danae"}}, "JP 38": {"type": "jumppoint", "x": -175542.86421969358, "y": -206383.85398666025, "grid": "B03", "hidden": true, "label": "**JP 38**"}, "Spirit Point": {"type": "station", "x": 108508.06170623237, "y": 42180.96082815458, "grid": "O17", "hidden": false, "label": "Spirit Point", "description": "Home of the Vesper Point Exploritory Team", "hull": "starbase_command", "facilities": [], "sides": ["USFP"], "hullName": "Command Starbase", "hullImage": "Images/Ships/tsn-big-base256.png", "hullDescription": ""}};
        console.log("[DEBUG JS] objData keys:", Object.keys(objData));
        console.log("[DEBUG JS] objData sample:", objData[Object.keys(objData)[0]]);

    function clearAnnotations() {
        Plotly.relayout('plot', {annotations: []});
        document.getElementById('info').innerHTML = getInfoHeader() + 'Select an object';
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        document.getElementById('galactic-map-btn').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
    }
    
    function getInfoHeader() {
    return '<img src="Images/Compass.png" alt="Compass" '
         + 'style="display:block; max-width:100%; height:auto; margin-bottom:10px;">'
         + '<button id="galactic-map-btn" title="Back to Galactic Map">Galactic Map</button>';
        }
    
    function highlight(name) {
        var obj = objData[name];
        if (obj.hidden && !isGM()) {
            alert("This object is not visible on the public map.");
            return;
        }
        var annotation = {
            x: obj.x, y: obj.y, xref: 'x', yref: 'y', text: name,
            showarrow: true, arrowcolor: 'yellow', arrowwidth: 2,
            arrowhead: 3, font: {color: 'yellow', size: 28}
        };

        Plotly.relayout('plot', {annotations: [annotation]});

        var label = obj.label || name;
        var infoHtml = '<span style="font-size:20pt;">' + label + '</span><br>';
        infoHtml += '<b>Location:</b> ' + obj.grid + '<br>';

        if (obj.type === 'station') {
            // Station selected: display detailed station info
            if (obj.hullImage) {
                infoHtml += '<img src="' + obj.hullImage + '" alt="Hull Art" style="max-width:48%; height:auto;">';
            }
            if (obj.sides && obj.sides.length > 0) {
                infoHtml += '<img src="Images/Factions/' + obj.sides[0] + '.png" alt="Faction Logo" style="max-width:48%; height:auto;">';
            }
            infoHtml += '<b>Facilities:</b> ' + (obj.facilities.length ? obj.facilities.join(', ') : 'None') + '<br>';
            if (obj.hullName && obj.hullImage) {
                infoHtml += '<b>General Class:</b> ' + obj.hullName + '<br>';
            }
            if (obj.hullDescription) {
                infoHtml += '<p style="margin-top:5px; font-size:90%; color:#ccc;">' + obj.hullDescription + '</p>';
            }
        } 
        else if ((obj.type === 'jump_point' || obj.type === 'jumppoint' || obj.type === 'jumpnode') && obj.destinations && typeof obj.destinations === 'object') {
        
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
            infoHtml += '<br><br><b>Destinations:</b><br>';
            for (const [target, label] of Object.entries(obj.destinations)) {
                if (typeof target === 'string' && typeof label === 'string') {
                    let file = label + '.html';
                    // Correctly escape single quotes for JS string
                    infoHtml += `<button onclick="window.open('${file}', '_blank')">${label}, ${target}</button>`;
                }
            }
            }
        else if (obj.type === 'sensor_relay') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Standard sensor and info relay buoy, Serial: ' + serial;
        }
        else if (obj.type === 'jumpnode' || obj.type === 'jumppoint') {
            // Generate a random 5-character alphanumeric serial
            const serial = Math.random().toString(36).substring(2, 7).toUpperCase();
            infoHtml += 'Oliver Class jump stabilisation node. Serial: ' + serial;
        }
        else {
            infoHtml += '<b>Type:</b> ' + obj.type;
        }

            // ——— append a description paragraph if one exists ———
            if (obj.description) {
                infoHtml += '<p style="font-size:90%; margin-top:8px;">'
                          + obj.description
                          + '</p>';
            }
            document.getElementById('info').innerHTML = getInfoHeader() + infoHtml;
            document.getElementById('galactic-map-btn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
                + infoHtml;
         
    }
         document.getElementById('galactic-map-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
    

    var fig = {"data": [{"type": "scatter", "x": [-115701.80596390832, -95701.80596390832, -115383.92247547879, -135383.9224754788, -115701.80596390832], "y": [27673.649285478765, 138506.98261881212, 142058.64274120075, 31225.30940786742, 27673.649285478765], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-44833.812201838715, -111500.47886850536, -127918.58290421512, -61251.91623754845, -44833.812201838715], "y": [-14006.542438007575, 81826.79089532577, 70405.50113135378, -25427.832201979563, -14006.542438007575], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [159745.53437688728, 133912.20104355397, 121668.73718372562, 147502.07051705892, 159745.53437688728], "y": [151523.3830894789, 171523.3830894789, 155708.90893720064, 135708.90893720064, 151523.3830894789], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [52813.13949812417, 6146.472831457497, 4434.465395822037, 51101.13206248871, 52813.13949812417], "y": [108623.79878873963, 156123.79878873963, 154441.82657127324, 106941.82657127321, 108623.79878873963], "fill": "toself", "fillcolor": "rgba(128,0,128,0.5005869694840526)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.5005869694840526)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [162146.937286867, 219646.937286867, 204267.33427374595, 146767.33427374595, 162146.937286867], "y": [-113609.9138736403, -44443.2472069736, -31657.794099680214, -100824.46076634689, -113609.9138736403], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [-179749.98730890738, -159749.98730890738, -179669.0744638131, -199669.0744638131, -179749.98730890738], "y": [-230615.79275555327, -8949.126088886565, -7151.915217767251, -228818.58188443392, -230615.79275555327], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [-105393.75469150963, -145393.75469150965, -164025.30708121083, -124025.30708121085, -105393.75469150963], "y": [-223581.76246346653, -121081.76246346653, -128352.61217652066, -230852.61217652066, -223581.76246346653], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [-45818.9312788107, -150818.9312788107, -148600.1304939098, -43600.13049390978, -45818.9312788107], "y": [-207247.98025588534, -213081.31358921865, -253019.72771743516, -247186.39438410185, -207247.98025588534], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [-89795.2497194125, -103961.91638607916, -123790.47871997464, -109623.81205330798, -89795.2497194125], "y": [-185077.32080962064, -77577.32080962062, -80190.38716369988, -187690.38716369987, -185077.32080962064], "fill": "toself", "fillcolor": "rgba(255,255,0,0.6)", "line": {"shape": "spline", "color": "yellow", "width": 2}, "hoverinfo": "none", "gmOnly": true}, {"type": "scatter", "x": [77641.57635514476, -47358.42364485524, -28727.304794531865, 96272.69520546813, 77641.57635514476], "y": [180466.49799512725, 139633.1646617939, 82599.12736488561, 123432.46069821897, 180466.49799512725], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [79945.94804433554, -54220.718622331144, -51865.00981705602, 82301.65684961066, 79945.94804433554], "y": [-176587.0647708621, -184920.39810419548, -222847.30986912502, -214513.97653579165, -176587.0647708621], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [82432.59750506484, 41599.2641717315, 27315.00738888136, 68148.3407222147, 82432.59750506484], "y": [-241051.2348297303, -199384.56816306367, -213383.13981025683, -255049.80647692346, -241051.2348297303], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [127471.48258964969, 49138.149256316356, 49776.122304296536, 128109.45563762989, 127471.48258964969], "y": [-7222.276234970719, -9722.276234970719, -29712.098405016426, -27212.098405016426, -7222.276234970719], "fill": "toself", "fillcolor": "rgba(128,0,128,0.4)", "line": {"shape": "spline", "color": "rgba(128,0,128,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [58668.403110656545, -62998.26355601014, -59754.13155004368, 61912.535116623, 58668.403110656545], "y": [33483.7141981544, 13483.7141981544, -6251.422171474873, 13748.577828525127, 33483.7141981544], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [73539.14706019462, 64372.48039352797, 44541.79116708492, 53708.45783375158, 73539.14706019462], "y": [-59252.082668262185, 10747.917331737815, 8151.041361608369, -61848.95863839163, -59252.082668262185], "fill": "toself", "fillcolor": "rgba(165,42,42,0.4)", "line": {"shape": "spline", "color": "rgba(165,42,42,0.4)", "width": 0}, "hoverinfo": "none"}, {"type": "scatter", "x": [126957.13578030645], "y": [56949.4793466731], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["Temple Point Gate [O18]"], "hoverinfo": "text", "text": ["Temple Point Gate"], "textposition": "top center", "textfont": {"color": "white", "size": 20}}, {"type": "scatter", "x": [126957.13578030645], "y": [56949.4793466731], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["Temple Point Gate [O18]"], "hoverinfo": "text", "text": ["Temple Point Gate"], "textposition": "top center", "textfont": {"color": "white", "size": 20}}, {"type": "scatter", "x": [-175542.86421969358], "y": [-206383.85398666025], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["JP 38 [B03]"], "hoverinfo": "text", "text": ["**JP 38**"], "textposition": "top center", "textfont": {"color": "white", "size": 20}, "gmOnly": true}, {"type": "scatter", "x": [-175542.86421969358], "y": [-206383.85398666025], "mode": "markers+text", "marker": {"symbol": "circle-open", "size": 16, "color": "lightblue"}, "hovertext": ["JP 38 [B03]"], "hoverinfo": "text", "text": ["**JP 38**"], "textposition": "top center", "textfont": {"color": "white", "size": 20}, "gmOnly": true}, {"type": "scatter", "x": [108508.06170623237], "y": [42180.96082815458], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Spirit Point [O17]"], "hoverinfo": "text", "text": ["Spirit Point"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}, {"type": "scatter", "x": [108508.06170623237], "y": [42180.96082815458], "mode": "markers+text", "marker": {"symbol": "square", "size": 12, "color": "blue"}, "hovertext": ["Spirit Point [O17]"], "hoverinfo": "text", "text": ["Spirit Point"], "textposition": "top center", "textfont": {"color": "white", "size": 14}}], "layout": {"title": "Vesper Point", "paper_bgcolor": "black", "plot_bgcolor": "black", "font": {"color": "white"}, "margin": {"l": 0, "r": 0, "t": 40, "b": 0}, "autosize": true, "dragmode": "pan", "hovermode": "closest", "xaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "title": "X Axis"}, "yaxis": {"color": "white", "showgrid": true, "gridcolor": "gray", "dtick": 20000, "scaleanchor": "x", "scaleratio": 1, "title": "Z Axis"}, "shapes": []}};
    fig.layout.showlegend = false;
    fig.layout.dragmode = 'pan';
    fig.layout.title = 'Vesper Point';
    if (!isGM()) {
        fig.data = fig.data.filter(t => !t.gmOnly);
        }
    Plotly.newPlot('plot', fig.data, fig.layout, {responsive: true, scrollZoom: true});
        console.log("[DEBUG JS] Plotted traces count:", fig.data.length);
        console.log("[DEBUG JS] fig.data sample:", fig.data.slice(0,3));

    var plotDiv = document.getElementById('plot');
    // Custom click: select nearest object within 10px of cursor
    plotDiv.addEventListener('click', function(evt) {
        var rect = plotDiv.getBoundingClientRect();
        var px = evt.clientX - rect.left;
        var py = evt.clientY - rect.top;
        var xaxis = plotDiv._fullLayout.xaxis;
        var yaxis = plotDiv._fullLayout.yaxis;
        var l2px = xaxis.l2p.bind(xaxis);
        var l2py = yaxis.l2p.bind(yaxis);
        var minDist = Infinity, closest = null;
        for (var name in objData) {
            var pt = objData[name];
            var xPx = l2px(pt.x);
            var yPx = l2py(pt.y);
            var dx = xPx - px, dy = yPx - py;
            var d = Math.sqrt(dx*dx + dy*dy);
            console.log(`${name}: data=(${pt.x}, ${pt.y}) -> screen=(${xPx.toFixed(1)}, ${yPx.toFixed(1)}), cursor=(${px.toFixed(1)}, ${py.toFixed(1)}), dx=${dx.toFixed(1)}, dy=${dy.toFixed(1)}, d=${d.toFixed(1)}`);
            if (d < minDist) {
                minDist = d;
                closest = name;
            }
        }
        if (minDist <= 35 && closest) {
            highlight(closest);
        }
    });

  var ctrl = document.getElementById('object-buttons');

  // Helper: create and append a single button
function addButton(label, fn, header, color, isHidden) {
    if (isHidden && !isGM()) return;
    var btn = document.createElement('button');
    btn.textContent = label;
    if (header) {
      btn.className = 'header';     // section header style
      btn.onclick = null;           // no click action
    } else {
      btn.onclick = fn;             // bind the handler
      if (color) btn.style.backgroundColor = color;
    }
    ctrl.appendChild(btn);
  }
  
  function enterGMMode() {
    const pw = prompt("Enter ONI Auth Code: --We will store a cookie for the purpose of tracking if you have authenticated or not--");
    if (pw === "oni1") {
      document.cookie = "gmMode=1; path=/; max-age=31536000";
      location.reload();
    } else {
      alert("Incorrect password.");
    }
  }

  function isGM() {
    return document.cookie.split(';').some(c => c.trim() === 'gmMode=1');
  }

  function exitGMMode() {
    document.cookie = "gmMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
    location.reload();
  }

  function renderGMControls() {
    const div = document.getElementById('gm-controls');
    div.innerHTML = '';
    const btn = document.createElement('button');
    btn.style.width = '100%';
    if (isGM()) {
      btn.textContent = 'ONI Logout';
      btn.onclick = exitGMMode;
    } else {
      btn.textContent = 'ONI Login';
      btn.onclick = enterGMMode;
    }
    div.appendChild(btn);
  }

  renderGMControls();

  // ——— Populate the sidebar ———
  addButton('None', clearAnnotations, false, null);

  addButton('--- Gates ---', null, true, null);
  addButton('JP 38',function(){highlight('JP 38');},false,null,true)
    addButton('Temple Point Gate',function(){highlight('Temple Point Gate');},false,null,false)

  addButton('--- Nav Points/POI ---', null, true, null);
  

  addButton('--- Stations ---', null, true, null);
  addButton('Spirit Point',function(){highlight('Spirit Point');},false,'blue',false)
    
  // Search filter
  document.getElementById('search-box').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const buttons = document.querySelectorAll('#object-buttons button');
    buttons.forEach(btn => {
      const label = btn.textContent.toLowerCase();
      const isHeader = btn.classList.contains('header');
      if (isHeader) {
        btn.style.display = ''; // always show section headers
      } else {
        btn.style.display = label.includes(query) ? '' : 'none';
      }
    });
  });
</script>
</body>
</html>